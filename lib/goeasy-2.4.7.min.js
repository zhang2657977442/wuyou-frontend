!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.GoEasy=t():e.GoEasy=t()}(this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=t.GoEasyDomainNumber=t.goEasyArray=t.UUID=t.calibrator=undefined;var o=n(31),r=n(89),i=n(93),s=n(52);t.calibrator=o.calibrator,t.UUID=r.UUID,t.goEasyArray=i.goEasyArray,t.GoEasyDomainNumber=s.GoEasyDomainNumber,t.noop=function(){}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t["default"]={WRITE:"WRITE",READ:"READ",NONE:"NONE"}},function(e,t,n){"use strict";t.__esModule=!0,t.GoEasyIM=t.PubSub=t.ConversationDTO=t.MessageStatus=t.Scene=t.CallBackOptions=void 0;var o,r=n(12),i=n(66),s=n(0),a=n(98),u=n(6),c=n(160),l=n(161),f=n(162),p=n(163),h=n(165),d=n(167),y=n(16),m=n(8),v=n(10),g=function(){return function(){}}();t.CallBackOptions=g,function(e){e.PRIVATE="private",e.GROUP="group",e.SYSTEM="system"}(o=t.Scene||(t.Scene={})),function(e){e.NEW="new",e.SENDING="sending",e.SUCCESS="success",e.FAIL="fail"}(t.MessageStatus||(t.MessageStatus={}));var b=function(){return function(){}}();t.ConversationDTO=b;var E=function(){function e(e){this.neverConnect=!0,this.options=e}return e.prototype.initialGoEasySocket=function(e){this.goEasySocket=e,this.subscriber.initialGoEasySocket(),this.presence.initialGoEasySocket()},e.prototype.initialBeforeConnect=function(){this.neverConnect=!1,this.publisher=new f["default"](this),this.subscriber=new p["default"](this),this.histories=new c["default"](this),this.presence=new h["default"](this),this.hereNows=new l["default"](this)},e.prototype.validateOptions=function(){var e=this.options;if(!e.modules||!e.modules.includes(a.ModuleTypes.PUBSUB))throw{code:400,content:"Invalid options: module '"+a.ModuleTypes.PUBSUB+"' is not enabled"}},e.prototype.publish=function(e){this.validateOptions(),this.publisher.publish(e)},e.prototype.subscribe=function(e){this.validateOptions(),this.subscriber.subscribe(e)},e.prototype.unsubscribe=function(e){this.validateOptions(),this.subscriber.unsubscribe(e)},e.prototype.subscribePresence=function(e){this.validateOptions(),this.presence.subscribePresence(e)},e.prototype.unsubscribePresence=function(e){this.validateOptions(),this.presence.unsubscribePresence(e)},e.prototype.history=function(e){this.validateOptions(),this.histories.get(e)},e.prototype.hereNow=function(e){this.validateOptions(),this.hereNows.byChannel(e)},e.prototype.hereNowByUserIds=function(e){this.validateOptions(),this.hereNows.byUserId(e)},e}();t.PubSub=E;var _=function(){function e(e){this.options=e}return e.prototype.initialBeforeConnect=function(e){u.im.initialBeforeConnect(e)},e.prototype.initialAfterConnect=function(){u.im.initialAfterConnect()},e.prototype.initialGoEasySocket=function(e){u.im.initialGoEasySocket(e)},e.prototype.validateOptions=function(){var e=this.options;if(!e.modules||!e.modules.includes(a.ModuleTypes.IM))throw Error("Invalid options: module '"+a.ModuleTypes.IM+"' is not enabled")},e.prototype.validateMessageToData=function(e){if(!s.calibrator.isObject(e.to))throw{code:400,content:"TypeError: to requires an object."};if(!s.calibrator.isObject(e.to.data))throw{code:400,content:"TypeError: to.data requires an object."}},e.prototype.on=function(e,t){this.validateOptions(),u.im.on(e,t)},e.prototype.createTextMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createTextMessage(e)},e.prototype.createImageMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createImageMessage(e)},e.prototype.createFileMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createFileMessage(e)},e.prototype.createAudioMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createAudioMessage(e)},e.prototype.createVideoMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createVideoMessage(e)},e.prototype.createCustomMessage=function(e){return this.validateOptions(),this.validateMessageToData(e),u.im.createCustomMessage(e)},e.prototype.sendMessage=function(e){this.validateOptions(),u.im.sendMessage(e)},e.prototype.recallMessage=function(e){this.validateOptions(),u.im.recallMessage(e)},e.prototype.deleteMessage=function(e){this.validateOptions(),u.im.deleteMessage(e)},e.prototype.markGroupMessageAsRead=function(e){this.validateOptions(),u.im.groupMarkAsRead(e)},e.prototype.markPrivateMessageAsRead=function(e){this.validateOptions(),u.im.privateMarkAsRead(e)},e.prototype.latestConversations=function(e){this.validateOptions(),u.im.latestConversations().then(function(t){m.CallbackUtils.onSuccess(e,t)})["catch"](function(t){m.CallbackUtils.onFailed(e,t)})},e.prototype.removePrivateConversation=function(e){this.validateOptions(),u.im.removePrivateConversation(e)},e.prototype.removeGroupConversation=function(e){this.validateOptions(),u.im.removeGroupConversation(e)},e.prototype.topPrivateConversation=function(e){this.validateOptions(),u.im.topPrivateConversation(e)},e.prototype.topGroupConversation=function(e){this.validateOptions(),u.im.topGroupConversation(e)},e.prototype.history=function(e){this.validateOptions(),u.im.history(e)},e.prototype.subscribeUserPresence=function(e){this.validateOptions(),u.im.subscribeUserPresence(e.userIds).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.unsubscribeUserPresence=function(e){this.validateOptions(),u.im.unsubscribeUserPresence(e.userId).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.hereNow=function(e){this.validateOptions(),u.im.hereNow(e).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.subscribeGroup=function(e){this.validateOptions(),u.im.subscribeGroup(e).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.unsubscribeGroup=function(e){this.validateOptions(),u.im.unsubscribeGroup(e.groupId).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.subscribeGroupPresence=function(e){this.validateOptions(),u.im.subscribeGroupPresence(e.groupIds).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.unsubscribeGroupPresence=function(e){this.validateOptions(),u.im.unsubscribeGroupPresence(e.groupId).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.groupHereNow=function(e){this.validateOptions(),u.im.groupHereNow(e.groupId).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.groupOnlineCount=function(e){this.validateOptions(),u.im.groupOnlineCount(e.groupId).then(function(t){s.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)})["catch"](function(t){s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e}();t.GoEasyIM=_;var S=function(){function e(t){if(s.calibrator.isDef(e.instance)&&e.instance.getConnectionStatus()!==r["default"].DISCONNECTED)return e.instance;this.validateOptions(t),this.options=t,this.pubsub=new E(this.options),this.im=new _(this.options),this.notification=new d.GoEasyNotification(this.options.allowNotification)}return e.getInstance=function(t){return s.calibrator.isUndef(e.instance)&&(e.instance=new e(t)),e.instance},e.prototype.connect=function(e){this.getConnectionStatus()!==r["default"].DISCONNECTED&&s.calibrator.isObject(e)&&s.calibrator.isFunction(e.onFailed)?e.onFailed({code:408,content:"It is already connected, don't try again until disconnect() is called. "}):(this.confirmUserId(e),v.GoEasyEventCenter.initial(),this.notification.listenNewMessage(),this.pubsub.initialBeforeConnect(),this.im.initialBeforeConnect({id:e.id,data:e.data}),this.goEasySocket=new i["default"](this.options,e),this.im.initialGoEasySocket(this.goEasySocket),this.goEasySocket.connect(this.notification),this.pubsub.initialGoEasySocket(this.goEasySocket),this.im.initialAfterConnect())},e.prototype.disconnect=function(e){this.goEasySocket.disconnect(e).then(function(){s.calibrator.isObject(e)&&s.calibrator.isFunction(e.onSuccess)&&e.onSuccess()})["catch"](function(t){s.calibrator.isObject(e)&&s.calibrator.isFunction(e.onFailed)&&e.onFailed(t)})},e.prototype.getConnectionStatus=function(){return this.goEasySocket?this.goEasySocket.getStatus():r["default"].DISCONNECTED},e.prototype.validateOptions=function(e){var t="";if(!s.calibrator.isObject(e))throw t="options is require an object.",Error(t);if(!s.calibrator.isPrimitive(e.appkey)||0==e.appkey.length)throw t="Invalid options:'host' is empty.",Error(t);if(!s.calibrator.isPrimitive(e.host)||0==e.host.length)throw t="Invalid options:'host' is empty.",Error(t);if(!s.calibrator.isArray(e.modules))throw t="Invalid options: 'modules' must be nonempty array",Error(t);var n=[a.ModuleTypes.IM,a.ModuleTypes.PUBSUB],o=e.modules.map(function(e){var o=e.toUpperCase();if(!n.includes(o))throw t="Invalid options: module '"+e+"' is not support",Error(t);return o});e.modules=o},e.prototype.onClickNotification=function(e){this.notification.onClickNotification(e)},e.prototype.confirmUserId=function(e){if(this.options.modules.includes(a.ModuleTypes.IM)&&(s.calibrator.isEmpty(e.id)||!s.calibrator.isStringOrNumber(e.id)))throw{code:400,content:"TypeError: id requires number or string."};if("string"==typeof e.id&&e.id.length>60)throw{code:400,content:"id over max length 60"}},e.version="2.4.7",e.IM_EVENT=y.ImApiEvents,e.IM_SCENE=o,e}();t["default"]=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(0),s=n(1),a=(o=s)&&o.__esModule?o:{"default":o};var u=function(){function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uuid=null,this.name="",this.params=null,this.success=null,this.fail=null,this.permission=a["default"].NONE,this.singleTimeout=0,this.totalTimeout=0,this.startTime=0,this.complete=!1,this.retried=0,this.unique=!1,this.uuid=i.UUID.get(),this.name=t.name,this.params=t.params,this.permission=t.permission,this.totalTimeout=t.totalTimeout,this.singleTimeout=t.singleTimeout,t.unique&&(this.unique=t.unique),this.success=function(e){n.complete||(n.complete=!0,t.success(e))},this.fail=function(e){n.complete||(n.complete=!0,t.fail(e))}}return r(e,[{key:"start",value:function(){this.startTime=Date.now()}},{key:"isTimeout",value:function(){return this.startTime+this.totalTimeout<Date.now()}}]),e}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SocketTimeout={connect:1500,reconnectionDelayMax:3e3,commonQuerySingle:2500,commonQueryTotal:12e3,commonRequestSingle:1700,commonRequestTotal:12e3,commonInfiniteSingle:1700,commonInfiniteTotal:864e5}},function(e,t,n){"use strict";t.__esModule=!0,t.RocketTypes=void 0,function(e){e.authorize="authorize",e.manualDisconnect="manualDisconnect",e.subscribe="subscribe",e.unsubscribe="unsubscribe",e.publish="publish",e.ack="ack",e.historyMessages="historyMessages",e.hereNow="hereNow",e.hereNowByUserIds="hereNowByUserIds",e.imLastConversations="imLastConversations",e.markPrivateMessageAsRead="markPrivateMessageAsRead",e.markGroupMessageAsRead="markGroupMessageAsRead",e.imGroupOnlineCount="imGroupOnlineCount",e.imHereNow="imHereNow",e.imGroupHereNow="imGroupHereNow",e.publishIM="publishIM",e.subscribeUserPresence="subscribeUserPresence",e.unsubscribeUserPresence="unsubscribeUserPresence",e.subscribeGroupPresence="subscribeGroupPresence",e.unsubscribeGroupPresence="unsubscribeGroupPresence",e.removeConversation="removeConversation",e.topConversation="topConversation",e.imData="imData",e.subscribeGroups="subscribeGroups",e.unsubscribeGroup="unsubscribeGroup",e.IM_DELETE_MESSAGE="IM_DELETE_MESSAGE",e.IM_HISTORY="IM_HISTORY",e.IM_HISTORY_CHANGE="IM_HISTORY_CHANGE",e.IM_RECALL_MESSAGE="IM_RECALL_MESSAGE"}(t.RocketTypes||(t.RocketTypes={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.im=t.IM=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=E(n(54)),i=E(n(109)),s=E(n(110)),a=E(n(111)),u=E(n(112)),c=E(n(113)),l=E(n(114)),f=E(n(116)),p=E(n(118)),h=n(119),d=E(n(134)),y=n(2),m=n(139),v=E(n(140)),g=n(19),b=n(8);function E(e){return e&&e.__esModule?e:{"default":e}}var _=t.IM=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._event=m.eventCenter,this.goEasyUploader=null,this._goEasySocket=null,this._dataCache=null,this.messageSender=null,this.conversations=null,this._iMReceiver=null,this.groupMessageSubscriber=null,this._groupPresenceSubscriber=null,this._groupOnlineCount=null,this._groupHereNow=null,this._userPresenceSubscriber=null,this._userHereNow=null}return o(e,[{key:"on",value:function(e,t){this._event.on(e,t)}},{key:"initialBeforeConnect",value:function(t){e.userId=t.id?t.id.toString():t.id,e.userData=t.data,this._dataCache=new p["default"](t),this.messageSender=new d["default"],this.goEasyUploader=new r["default"],this._userHereNow=new c["default"](this),this._groupHereNow=new l["default"](this),this._groupOnlineCount=new s["default"](this)}},{key:"initialAfterConnect",value:function(){this._iMReceiver=new f["default"](this),this.conversations=new v["default"](this),this._groupPresenceSubscriber=new a["default"](this),this.groupMessageSubscriber=new i["default"],this._userPresenceSubscriber=new u["default"](this)}},{key:"initialGoEasySocket",value:function(e){this._goEasySocket=e}},{key:"catch",value:function(e,t){try{e()}catch(n){b.CallbackUtils.onFailed(t,n)}}},{key:"createTextMessage",value:function(e){return h.iMMessageBuilder.buildMessage(g.MessageType.TEXT,e)}},{key:"createImageMessage",value:function(e){return h.iMMessageBuilder.buildMessage(g.MessageType.IMAGE,e)}},{key:"createFileMessage",value:function(e){return h.iMMessageBuilder.buildMessage(g.MessageType.FILE,e)}},{key:"createAudioMessage",value:function(e){return h.iMMessageBuilder.buildMessage(g.MessageType.AUDIO,e)}},{key:"createVideoMessage",value:function(e){return h.iMMessageBuilder.buildMessage(g.MessageType.VIDEO,e)}},{key:"createCustomMessage",value:function(e){return h.iMMessageBuilder.buildMessage(e.type,e)}},{key:"latestConversations",value:function(){return this.conversations?this.conversations.latestConversations():Promise.reject({code:500,content:"Please connect GoEasyIM first."})}},{key:"groupMarkAsRead",value:function(e){var t=this;this["catch"](function(){return t.conversations.groupMarkAsRead(e)},e)}},{key:"privateMarkAsRead",value:function(e){var t=this;this["catch"](function(){return t.conversations.privateMarkAsRead(e)},e)}},{key:"removePrivateConversation",value:function(e){return this.conversations.removePrivateConversation(e)}},{key:"removeGroupConversation",value:function(e){return this.conversations.removeGroupConversation(e)}},{key:"topPrivateConversation",value:function(e){return this.conversations.topPrivateConversation(e)}},{key:"topGroupConversation",value:function(e){return this.conversations.topGroupConversation(e)}},{key:"history",value:function(e){var t=this;this["catch"](function(){t.conversations.history(e)},e)}},{key:"upload",value:function(e,t,n){return this.goEasyUploader.upload(e,t,n)}},{key:"sendSystemMessage",value:function(e,t){return this.messageSender.send(e,t,y.Scene.SYSTEM)}},{key:"sendMessage",value:function(e){this.messageSender.send(e)}},{key:"subscribeUserPresence",value:function(e){return this._userPresenceSubscriber.presence(e)}},{key:"unsubscribeUserPresence",value:function(e){return this._userPresenceSubscriber.unPresence(e)}},{key:"hereNow",value:function(e){return this._userHereNow.hereNow(e,y.Scene.PRIVATE)}},{key:"recallMessage",value:function(e){var t=this;this["catch"](function(){t.conversations.recallMessage(e)},e)}},{key:"deleteMessage",value:function(e){var t=this;this["catch"](function(){t.conversations.deleteMessage(e)},e)}},{key:"subscribeGroup",value:function(e){return this.groupMessageSubscriber.subscribe(e)}},{key:"unsubscribeGroup",value:function(e){return this.groupMessageSubscriber.unsubscribe(e)}},{key:"subscribeGroupPresence",value:function(e){return this._groupPresenceSubscriber.presence(e)}},{key:"unsubscribeGroupPresence",value:function(e){return this._groupPresenceSubscriber.unPresence(e)}},{key:"groupHereNow",value:function(e){return this._groupHereNow.hereNow(e)}},{key:"groupOnlineCount",value:function(e){return this._groupOnlineCount.get(e)}}]),e}();_.version=null,_.userId=undefined,_.userData=null;var S=new _;t.im=S},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.str=t.noop=t.GoEasyDomainNumber=t.goEasyArray=t.UUID=t.calibrator=undefined;var o=n(115),r=n(0);t.calibrator=r.calibrator,t.UUID=r.UUID,t.goEasyArray=r.goEasyArray,t.GoEasyDomainNumber=r.GoEasyDomainNumber,t.noop=r.noop,t.str=o.str},function(e,t,n){"use strict";t.__esModule=!0,t.CallbackUtils=void 0;var o=n(31),r=function(){function e(){}return e.onSuccess=function(e,t){o.calibrator.isFunction(e.onSuccess)&&e.onSuccess(t)},e.onFailed=function(e,t){if(!o.calibrator.isObject(e)||!o.calibrator.isFunction(e.onFailed))throw t;e.onFailed(t)},e.validateCallbackOptions=function(e){if(o.calibrator.isUndef(e)||!o.calibrator.isObject(e))throw{code:400,content:"bad parameters"}},e}();t.CallbackUtils=r},function(e,t,n){"use strict";e.exports=function(){return function(){}}},function(e,t,n){"use strict";t.__esModule=!0,t.GoEasyEventCenter=void 0;var o=n(117),r=function(){function e(){}return e.initial=function(){this.eventDriver=new o.EmitterEventDriver},e.on=function(e,t){this.eventDriver.on(e,t)},e.fire=function(e,t){this.eventDriver.fire(e,t)},e}();t.GoEasyEventCenter=r},function(e,t,n){"use strict";t.__esModule=!0,t.AbstractPayloadBuilder=void 0;var o=function(){function e(){}return e.prototype.build=function(e){this.validate(e.createOptions);var t=this.create();return this.setPayload(e,t),t},e}();t.AbstractPayloadBuilder=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t["default"]={DISCONNECTED:"disconnected",DISCONNECTING:"disconnecting",CONNECTING:"connecting",CONNECTED:"connected",RECONNECTING:"reconnecting",RECONNECTED:"reconnected",EXPIRED_RECONNECTED:"reconnected",CONNECT_FAILED:"connect_failed"}},function(e,t,n){function o(e){if(e)return function(e){for(var t in o.prototype)e[t]=o.prototype[t];return e}(e)}e.exports=o,o.prototype.on=o.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},o.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},o.prototype.off=o.prototype.removeListener=o.prototype.removeAllListeners=o.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,o=this._callbacks["$"+e];if(!o)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<o.length;r++)if((n=o[r])===t||n.fn===t){o.splice(r,1);break}return this},o.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n)for(var o=0,r=(n=n.slice(0)).length;o<r;++o)n[o].apply(this,t);return this},o.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},o.prototype.hasListeners=function(e){return!!this.listeners(e).length}},function(e,t,n){"use strict";var o=n(74),r=n(45),i=n(78),s=n(79);"undefined"!=typeof navigator&&/Android/i.test(navigator.userAgent),"undefined"!=typeof navigator&&/PhantomJS/i.test(navigator.userAgent);t.protocol=3;var a=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},u=o(a),c={type:"error",data:"parser error"},l=n(80);t.encodePacket=function(e,t,n,o){"function"==typeof t&&(o=t,t=!1),"function"==typeof n&&(o=n,n=null);e.data===undefined?undefined:e.data.buffer||e.data;var r=a[e.type];return undefined!==e.data&&(r+=n?s.encode(String(e.data),{strict:!1}):String(e.data)),o(""+r)},t.decodePacket=function(e,t,n){if(e===undefined)return c;if("string"==typeof e){if(n&&!1===(e=function(e){try{e=s.decode(e,{strict:!1})}catch(t){return!1}return e}(e)))return c;var o=e.charAt(0);return Number(o)==o&&u[o]?e.length>1?{type:u[o],data:e.substring(1)}:{type:u[o]}:c}o=new Uint8Array(e)[0];var r=sliceBuffer(e,1);return l&&"blob"===t&&(r=new l([r])),{type:u[o],data:r}},t.encodePayload=function(e,n,o){"function"==typeof n&&(o=n,n=null);var s=r(e);if(!e.length)return o("0:");!function(e,t,n){for(var o=new Array(e.length),r=i(e.length,n),s=function(e,n,r){t(n,function(t,n){o[e]=n,r(t,o)})},a=0;a<e.length;a++)s(a,e[a],r)}(e,function(e,o){t.encodePacket(e,!!s&&n,!0,function(e){o(null,function(e){return e.length+":"+e}(e))})},function(e,t){return o(t.join(""))})},t.decodePayload=function(e,n,o){var r;if("function"==typeof n&&(o=n,n=null),""===e)return o(c,0,1);for(var i,s,a="",u=0,l=e.length;u<l;u++){var f=e.charAt(u);if(":"===f){if(""===a||a!=(i=Number(a)))return o(c,0,1);if(a!=(s=e.substr(u+1,i)).length)return o(c,0,1);if(s.length){if(r=t.decodePacket(s,n,!0),c.type===r.type&&c.data===r.data)return o(c,0,1);if(!1===o(r,u+i,l))return}u+=i,a=""}else a+=f}return""!==a?o(c,0,1):void 0}},function(e,t,n){"use strict";t.__esModule=!0,t.RemoteEvents=void 0,function(e){e.message="message",e.imMessage="imMessage",e.userPresence="userPresence",e.groupPresence="groupPresence",e.IM_MSG_READ="IM_MSG_READ",e.IM_MSG_DELETED="IM_MSG_DELETED",e.IM_MSG_RECALLED="IM_MSG_RECALLED"}(t.RemoteEvents||(t.RemoteEvents={}))},function(e,t,n){"use strict";t.__esModule=!0,t.ImApiEvents=void 0,function(e){e.PRIVATE_MESSAGE_RECEIVED="PRIVATE_MESSAGE_RECEIVED",e.GROUP_MESSAGE_RECEIVED="GROUP_MESSAGE_RECEIVED",e.SYSTEM_MESSAGE_RECEIVED="SYSTEM_MESSAGE_RECEIVED",e.CONVERSATIONS_UPDATED="CONVERSATIONS_UPDATED",e.USER_PRESENCE="USER_PRESENCE",e.GROUP_PRESENCE="GROUP_PRESENCE",e.MESSAGE_DELETED="MESSAGE_DELETED",e.MESSAGE_READ="MESSAGE_READ",e.MESSAGE_RECALLED="MESSAGE_RECALLED"}(t.ImApiEvents||(t.ImApiEvents={}))},function(e,t,n){"use strict";t.__esModule=!0,t.Target=void 0;var o=n(2),r=n(6),i=n(7),s=n(63),a=function(){function e(e,t){this.scene=e,this.id=t.toString()}return e.byScene=function(t,n){return new e(t,n)},e.byIds=function(t,n){var r=o.Scene.PRIVATE,s=t;return i.calibrator.isDef(n)&&(r=o.Scene.GROUP,s=n),e.byScene(r,s)},e.byIMMessage=function(t){var n,i=t.scene();if(i===o.Scene.PRIVATE){var s=t.senderId,a=t.targetId();n=r.IM.userId===s?a:s}else i===o.Scene.GROUP&&(n=t.targetId());return new e(i,n)},e.byMessageReadRemoteEvent=function(t){var n,i=t.scene,s=t.targetId,a=t.markerId;return i===o.Scene.PRIVATE?n=r.IM.userId===a?s:a:i===o.Scene.GROUP&&(n=s),new e(i,n)},e.byIMMessageDeletedEvent=function(t){var n=t.scene,i=t.deleterId;return n===o.Scene.PRIVATE?new e(n,r.IM.userId===i?t.targetId:i):n===o.Scene.GROUP?new e(n,t.targetId):void 0},e.byMessageRecalledRemoteEvent=function(t){var n=t.scene;return new e(n,s["default"].targetId(n,t.conversationId))},e}();t.Target=a},function(e,t,n){"use strict";(function(e){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.FrameworkDetector=t.Framework=void 0;var r,i=n(23);!function(e){e.UNIAPP="UNIAPP",e.REACT_NATIVE="REACT_NATIVE",e.TARO="TARO",e.IONIC="IONIC",e.NATIVE_APPLET_WX="NATIVE_APPLET_WX",e.NATIVE_APPLET_ALIPAY="NATIVE_APPLET_ALIPAY",e.UNKNOWN="UNKNOWN"}(r=t.Framework||(t.Framework={}));var s=function(){function t(){var e,t,n;this.framework=null,this.methods=((e={})[r.UNIAPP]=this.isUniApp,e[r.REACT_NATIVE]=this.isReactNative,e[r.NATIVE_APPLET_WX]=this.isWXApplet,e);var i=this.methods,s=Object.keys(i);try{for(var a=o(s),u=a.next();!u.done;u=a.next()){var c=u.value;if((0,i[c])()){this.framework=c;break}}}catch(l){t={error:l}}finally{try{u&&!u.done&&(n=a["return"])&&n.call(a)}finally{if(t)throw t.error}}this.framework=this.framework||r.UNKNOWN,this.framework}return t.currentFramework=function(){return this.instance.framework},t.prototype.isUniApp=function(){return"object"==typeof uni&&!!uni.getSystemInfoSync},t.prototype.isReactNative=function(){return void 0!==e&&e.__fbGenNativeModule},t.prototype.isTaro=function(){return!1},t.prototype.isWXApplet=function(){return i.PlatformDetector.currentPlatform()===i.Platform.APPLET_WX&&"undefined"==typeof uni},t.instance=new t,t}();t.FrameworkDetector=s}).call(this,n(28))},function(e,t,n){"use strict";t.__esModule=!0,t.MessageType=void 0,function(e){e.TEXT="text",e.IMAGE="image",e.FILE="file",e.VIDEO="video",e.AUDIO="audio"}(t.MessageType||(t.MessageType={}))},function(e,t,n){"use strict";t.__esModule=!0,t.IM_INTERNAL_EVENTS=void 0,function(e){e.MESSAGE_SENDING="IM_INTERNAL_MESSAGE_SENDING",e.MESSAGE_SEND_SUCCESS="IM_INTERNAL_MESSAGE_SEND_SUCCESS",e.MESSAGE_RECEIVED="IM_INTERNAL_MESSAGE_RECEIVED",e.REMOTE_MESSAGE_READ="IM_INTERNAL_REMOTE_MESSAGE_READ",e.REMOTE_MESSAGE_DELETED="IM_INTERNAL_REMOTE_MESSAGE_DELETED",e.MAX_MESSAGE_CHANGED="IM_INTERNAL_MAX_MESSAGE_CHANGED",e.UNREAD_MESSAGE_CHANGED="IM_INTERNAL_UNREAD_MESSAGE_CHANGED",e.REMOTE_MESSAGE_RECALLED="IM_INTERNAL_REMOTE_MESSAGE_RECALLED"}(t.IM_INTERNAL_EVENTS||(t.IM_INTERNAL_EVENTS={}))},function(e,t,n){"use strict";t.__esModule=!0,t.AbstractMessage=void 0;var o=function(){function e(){}return e.prototype.clearUseLessAttribute=function(){delete this.buildOptions},e}();t.AbstractMessage=o},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.FileMessagePayload=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.contentType="",t.name="",t.size=0,t.url="",t}return r(t,e),t}(n(25).AbstractMessagePayload);t.FileMessagePayload=i},function(e,t,n){"use strict";var o,r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.PlatformDetector=t.Platform=void 0,function(e){e.BROWSER="BROWSER",e.UNKNOWN="UNKNOWN",e.APP_IOS="APP_IOS",e.APP_ANDROID="APP_ANDROID",e.APPLET_WX="APPLET_WX",e.APPLET_WX_GAME="APPLET_WX_GAME",e.APPLET_ALIPAY="APPLET_ALIPAY",e.APPLET_BYTEDANCE="APPLET_BYTEDANCE"}(o=t.Platform||(t.Platform={}));var i=function(){function e(){var e,t,n;this.platform=null,this.methods=((e={})[o.BROWSER]=this.isBrowser,e[o.APP_IOS]=this.isAppiOS,e[o.APP_ANDROID]=this.isAppAndroid,e[o.APPLET_WX]=this.isWXApplet,e[o.APPLET_WX_GAME]=this.isWXGameApplet,e);var i=this.methods,s=Object.keys(i);try{for(var a=r(s),u=a.next();!u.done;u=a.next()){var c=u.value;if((0,i[c])()){this.platform=c;break}}}catch(l){t={error:l}}finally{try{u&&!u.done&&(n=a["return"])&&n.call(a)}finally{if(t)throw t.error}}this.platform=this.platform||o.UNKNOWN,this.platform}return e.currentPlatform=function(){return e.instance.platform},e.prototype.isBrowser=function(){return"undefined"!=typeof navigator&&"undefined"!=typeof document&&!!document.getElementById&&"undefined"==typeof GameGlobal},e.prototype.isAppiOS=function(){return"object"==typeof uni&&!!uni.getSystemInfoSync&&"ios"===uni.getSystemInfoSync().platform&&"object"==typeof plus},e.prototype.isAppAndroid=function(){return"object"==typeof uni&&!!uni.getSystemInfoSync&&"android"===uni.getSystemInfoSync().platform&&"object"==typeof plus},e.prototype.isWXApplet=function(){return"object"==typeof wx&&!!wx.getSystemInfoSync&&"undefined"==typeof WebSocket&&"undefined"==typeof XMLHttpRequest&&"undefined"==typeof plus},e.prototype.isWXGameApplet=function(){return"object"==typeof GameGlobal},e.prototype.isAlipayApplet=function(){return!1},e.prototype.isBytedanceApplet=function(){return!1},e.prototype.isQQApplet=function(){return!1},e.prototype.isBaiduApplet=function(){return!1},e.instance=new e,e}();t.PlatformDetector=i},function(e,t){t.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},t.decode=function(e){for(var t={},n=e.split("&"),o=0,r=n.length;o<r;o++){var i=n[o].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},function(e,t,n){"use strict";t.__esModule=!0,t.AbstractMessagePayload=void 0;var o=function(){return function(){}}();t.AbstractMessagePayload=o},function(e,t,n){"use strict";n(9)("socket.io-parser");var o=n(13),r=n(42);function i(){}t.protocol=4,t.types=["CONNECT","DISCONNECT","EVENT","ACK","ERROR","BINARY_EVENT","BINARY_ACK"],t.CONNECT=0,t.DISCONNECT=1,t.EVENT=2,t.ACK=3,t.ERROR=4,t.BINARY_EVENT=5,t.BINARY_ACK=6,t.Encoder=i,t.Decoder=a;var s=t.ERROR+'"encode error"';function a(){this.reconstructor=null}function u(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:t.ERROR,data:"parser error: "+e}}i.prototype.encode=function(e,n){n([function(e){var n=""+e.type;t.BINARY_EVENT!==e.type&&t.BINARY_ACK!==e.type||(n+=e.attachments+"-");e.nsp&&"/"!==e.nsp&&(n+=e.nsp+",");null!=e.id&&(n+=e.id);if(null!=e.data){var o=function(e){try{return JSON.stringify(e)}catch(t){return!1}}(e.data);if(!1===o)return s;n+=o}return n}(e)])},o(a.prototype),a.prototype.add=function(e){var n;if("string"!=typeof e)throw new Error("Unknown type: "+e);n=function(e){var n=0,o={type:Number(e.charAt(0))};if(null==t.types[o.type])return c("unknown packet type "+o.type);if(t.BINARY_EVENT===o.type||t.BINARY_ACK===o.type){for(var i="";"-"!==e.charAt(++n)&&(i+=e.charAt(n),n!=e.length););if(i!=Number(i)||"-"!==e.charAt(n))throw new Error("Illegal attachments");o.attachments=Number(i)}if("/"===e.charAt(n+1))for(o.nsp="";++n;){var s=e.charAt(n);if(","===s)break;if(o.nsp+=s,n===e.length)break}else o.nsp="/";var a=e.charAt(n+1);if(""!==a&&Number(a)==a){for(o.id="";++n;){var s=e.charAt(n);if(null==s||Number(s)!=s){--n;break}if(o.id+=e.charAt(n),n===e.length)break}o.id=Number(o.id)}if(e.charAt(++n)){var u=function(e){try{return JSON.parse(e)}catch(t){return!1}}(e.substr(n)),l=!1!==u&&(o.type===t.ERROR||r(u));if(!l)return c("invalid payload");o.data=u}return o}(e),this.emit("decoded",n)},a.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){var t=binary.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},function(e,t,n){"use strict";t.__esModule=!0,t.uniApp=void 0;var o=n(18),r=new(function(){function e(){this.uniAppRunningBackend=!1,this.listenAppRunning()}return e.prototype.listenAppRunning=function(){var e=this;o.FrameworkDetector.currentFramework()===o.Framework.UNIAPP&&"object"==typeof plus&&(plus.globalEvent.addEventListener("resume",function(){e.uniAppRunningBackend=!1,e.uniAppRunningBackend},!1),plus.globalEvent.addEventListener("pause",function(){e.uniAppRunningBackend=!0,e.uniAppRunningBackend},!1))},e.prototype.runningBackend=function(){return this.uniAppRunningBackend},e}());t.uniApp=r},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(o){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";var o=n(14),r=n(13);function i(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.forceNode=e.forceNode,this.isReactNative=e.isReactNative,this.extraHeaders=e.extraHeaders,this.localAddress=e.localAddress}e.exports=i,r(i.prototype),i.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},i.prototype.open=function(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this},i.prototype.close=function(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this},i.prototype.send=function(e){if("open"!==this.readyState)throw new Error("Transport not open");this.write(e)},i.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},i.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},i.prototype.onPacket=function(e){this.emit("packet",e)},i.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},function(e,t){e.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"isUndef",value:function(e){return e===undefined||null===e}},{key:"isTrue",value:function(e){return!0===e}},{key:"isFalse",value:function(e){return!1===e}},{key:"isPrimitive",value:function(e){return"string"==typeof e||"number"==typeof e||"symbol"===(void 0===e?"undefined":o(e))||"boolean"==typeof e}},{key:"isDef",value:function(e){return e!==undefined&&null!==e}},{key:"isObject",value:function(e){return null!==e&&"object"===(void 0===e?"undefined":o(e))}},{key:"isPlainObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"isRegExp",value:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{key:"isValidArrayIndex",value:function(e){var t=parseFloat(String(e));return t>=0&&Math.floor(t)===t&&isFinite(e)}},{key:"isStringOrNumber",value:function(e){return"string"==typeof e||"number"==typeof e}},{key:"isString",value:function(e){return"string"==typeof e}},{key:"isNumber",value:function(e){return"number"==typeof e}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isEmpty",value:function(e){return this.isArray(e)?0==e.length:this.isObject(e)?!this.isDef(e):!this.isNumber(e)&&(this.isString(e)?""==e.trim():!this.isDef(e))}},{key:"isNative",value:function(e){return"function"==typeof e&&/native code/.test(e.toString())}},{key:"isFunction",value:function(e){return"function"==typeof e}},{key:"isBoolean",value:function(e){return"boolean"==typeof e}}]),e}());t.calibrator=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"upload",value:function(e){throw Error("Not implementation yet.")}}]),e}();t["default"]=r},function(e,t,n){"use strict";t.__esModule=!0,t.RemoteAbbrMessageBuilder=void 0;var o=n(2),r=n(58),i=n(59),s=function(){function e(){}return e.prototype.build=function(e){var t;return e.t===o.Scene.PRIVATE?((t=new r.PrivateMessage).read=!1,t.receiverId=e.r):e.t===o.Scene.GROUP&&((t=new i.GroupMessage).groupId=e.r,t.senderData=e.d?JSON.parse(e.d):{}),t.senderId=e.s,t.messageId=e.i,t.timestamp=e.ts,t.type=e.mt,t.payload=JSON.parse(e.p),t.recalled=e.rc,t.status=o.MessageStatus.SUCCESS,t},e}();t.RemoteAbbrMessageBuilder=s},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.ImageMessagePayload=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.width=0,t.height=0,t}return r(t,e),t}(n(22).FileMessagePayload);t.ImageMessagePayload=i},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(11),s=n(22),a=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new s.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions.file;n.url=o.path,n.name=o.name,n.size=o.size,n.contentType=o.type,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!a.calibrator.isObject(e))throw Error("it is an empty message.");if(!a.calibrator.isDef(e.file))throw Error("file is empty.")},t}(i.AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.AudioMessagePayload=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.duration=0,t}return r(t,e),t}(n(22).FileMessagePayload);t.AudioMessagePayload=i},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.VideoMessagePayload=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.video=new a,t.thumbnail=new s,t}return r(t,e),t}(n(25).AbstractMessagePayload);t.VideoMessagePayload=i;var s=function(){return function(){this.name="",this.url="",this.width=0,this.height=0,this.contentType=""}}(),a=function(){return function(){this.name="",this.url="",this.width=0,this.height=0,this.contentType="",this.size=0,this.duration=0}}()},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(11),s=n(22),a=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new s.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions.file;n.url=o.fullPath,n.name=o.name,n.size=o.size,n.contentType=o.type,o.type,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!a.calibrator.isObject(e))throw Error("it is an empty message.");if(!a.calibrator.isDef(e.file))throw Error("file is empty.")},t}(i.AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(11),s=n(22),a=n(7),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new s.FileMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions.file,r=window.URL||window.webkitURL;n.url=r.createObjectURL(o),n.name=o.name,n.size=o.size,n.contentType=o.type},t.prototype.validate=function(e){if(!a.calibrator.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>31457280)throw Error("message-length limit 30mib")},t}(i.AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=c(n(12)),i=c(n(1)),s=c(n(67)),a=c(n(68)),u=n(0);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.io=a["default"],this.status=r["default"].DISCONNECTED,this.permissions=[i["default"].NONE],this.emitter=null,this.connectedObservers=[],this.disconnectedObservers=[],this.emitter=new s["default"](this)}return o(e,[{key:"connect",value:function(){this.status=r["default"].CONNECTING}},{key:"emit",value:function(e){this.emitter.emit(e)}},{key:"doEmit",value:function(e,t,n){}},{key:"on",value:function(e,t){this.io.on(e,t)}},{key:"disconnect",value:function(){this.io.disconnect()}},{key:"getStatus",value:function(){return this.status}},{key:"addConnectedObserver",value:function(e){u.calibrator.isFunction(e)&&this.connectedObservers.push(e)}},{key:"addDisconnectedObserver",value:function(e){u.calibrator.isFunction(e)&&this.disconnectedObservers.push(e)}},{key:"notify",value:function(e,t){for(var n=0;n<e.length;n++)e[n](t)}}]),e}();t["default"]=l},function(e,t){var n=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];e.exports=function(e){var t=e,r=e.indexOf("["),i=e.indexOf("]");-1!=r&&-1!=i&&(e=e.substring(0,r)+e.substring(r,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=n.exec(e||""),a={},u=14;u--;)a[o[u]]=s[u]||"";return-1!=r&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(27),i=n(70),s=n(49),a=n(13),u=n(26),c=n(50),l=n(51),f=(n(9)("socket.io-client:manager"),n(48)),p=n(86),h=n(52).GoEasyDomainNumber,d=Object.prototype.hasOwnProperty;function y(e,t){if(!(this instanceof y))return new y(e,t);e&&"object"===(void 0===e?"undefined":o(e))&&(t=e,e=undefined),(t=t||{}).path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||Infinity),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new p({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connecting=[],this.lastPing=null,this.encoding=!1,this.packetBuffer=[];var n=t.parser||u;this.encoder=new n.Encoder,this.decoder=new n.Decoder,this.autoConnect=!1!==t.autoConnect,this.autoConnect&&this.open()}function m(){var e=!1;return"object"===("undefined"==typeof uni?"undefined":o(uni))&&uni.getSystemInfo&&(e=!0),e&&r.uniApp.runningBackend()}e.exports=y,y.prototype.emitAll=function(){for(var e in this.emit.apply(this,arguments),this.nsps)d.call(this.nsps,e)&&this.nsps[e].emit.apply(this.nsps[e],arguments)},y.prototype.updateSocketIds=function(){for(var e in this.nsps)d.call(this.nsps,e)&&(this.nsps[e].id=this.generateId(e))},y.prototype.generateId=function(e){return("/"===e?"":e+"#")+this.engine.id},a(y.prototype),y.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},y.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},y.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},y.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},y.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},y.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},y.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},y.prototype.open=y.prototype.connect=function(e,t){if(this.readyState,~this.readyState.indexOf("open"))return this;this.uri,this.engine=i(this.uri,this.opts);var n=this.engine,o=this;this.readyState="opening",this.skipReconnect=!1;var r=c(n,"open",function(){o.onopen(),e&&e()}),s=c(n,"error",function(t){if("undefined"!=typeof window){var n=parseInt(o.uri.match(/[1-9][0-9]*/g)[0]),r=h.refreshNumber();o.uri=o.uri.replace(n,r)}if(o.cleanup(),o.readyState="closed",o.emitAll("connect_error",t),e){var i=new Error("Connection error");i.data=t,e(i)}else o.maybeReconnectOnOpen()});if(!1!==this._timeout){var a=this._timeout,u=setTimeout(function(){r.destroy(),n.close(),n.emit("error","timeout"),o.emitAll("connect_timeout",a)},a);this.subs.push({destroy:function(){clearTimeout(u)}})}return this.subs.push(r),this.subs.push(s),this},y.prototype.onopen=function(){this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(c(e,"data",l(this,"ondata"))),this.subs.push(c(e,"ping",l(this,"onping"))),this.subs.push(c(e,"pong",l(this,"onpong"))),this.subs.push(c(e,"error",l(this,"onerror"))),this.subs.push(c(e,"close",l(this,"onclose"))),this.subs.push(c(this.decoder,"decoded",l(this,"ondecoded")))},y.prototype.onping=function(){this.lastPing=new Date,this.emitAll("ping")},y.prototype.onpong=function(){this.emitAll("pong",new Date-this.lastPing)},y.prototype.ondata=function(e){this.decoder.add(e)},y.prototype.ondecoded=function(e){this.emit("packet",e)},y.prototype.onerror=function(e){this.emitAll("error",e)},y.prototype.socket=function(e,t){var n=this.nsps[e];if(!n){n=new s(this,e,t),this.nsps[e]=n;var o=this;n.on("connecting",r),n.on("connect",function(){n.id=o.generateId(e)}),this.autoConnect&&r()}function r(){~f(o.connecting,n)||o.connecting.push(n)}return n},y.prototype.destroy=function(e){var t=f(this.connecting,e);~t&&this.connecting.splice(t,1),this.connecting.length||this.close()},y.prototype.packet=function(e){var t=this;e.query&&0===e.type&&(e.nsp+="?"+e.query),t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(n){for(var o=0;o<n.length;o++)t.engine.write(n[o],e.options);t.encoding=!1,t.processPacketQueue()}))},y.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},y.prototype.cleanup=function(){for(var e=this.subs.length,t=0;t<e;t++){this.subs.shift().destroy()}this.packetBuffer=[],this.encoding=!1,this.lastPing=null,this.decoder.destroy()},y.prototype.close=y.prototype.disconnect=function(){this.skipReconnect=!0,this.reconnecting=!1,"opening"===this.readyState&&this.cleanup(),this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},y.prototype.onclose=function(e){this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},y.prototype.reconnect=function(){if(m(),this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||(m()?(e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error","Uniapp running backend, skipped reconnect...")):e.open(function(t){t?(e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):e.onreconnect()})))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},y.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},function(e,t,n){"use strict";var o=n(72),r=n(83);t.polling=function(e){var t=!1,n=!1;e.jsonp;if("undefined"!=typeof location){var r="https:"===location.protocol,i=location.port;i||(i=r?443:80),t=e.hostname!==location.hostname||i!==e.port,n=e.secure!==r}return e.xdomain=t,e.xscheme=n,new o(e)},t.websocket=r},function(e,t,n){(function(t){var o=n(42),r=Object.prototype.toString,i="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),s="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);e.exports=function a(e){if(!e||"object"!=typeof e)return!1;if(o(e)){for(var n=0,r=e.length;n<r;n++)if(a(e[n]))return!0;return!1}if("function"==typeof t&&t.isBuffer&&t.isBuffer(e)||"function"==typeof ArrayBuffer&&e instanceof ArrayBuffer||i&&e instanceof Blob||s&&e instanceof File)return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return a(e.toJSON(),!0);for(var u in e)if(Object.prototype.hasOwnProperty.call(e,u)&&a(e[u]))return!0;return!1}}).call(this,n(46).Buffer)},function(e,t,n){"use strict";(function(e){var o=n(75),r=n(76),i=n(77);function s(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return f(this,e)}return c(this,e,t,n)}function c(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");t=n===undefined&&o===undefined?new Uint8Array(t):o===undefined?new Uint8Array(t,n):new Uint8Array(t,n,o);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,n,o):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|d(t,n),r=(e=a(e,o)).write(t,n);r!==o&&(e=e.slice(0,r));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?a(e,0):p(e,t);if("Buffer"===t.type&&i(t.data))return p(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function f(e,t){if(l(t),e=a(e,t<0?0:0|h(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case undefined:return G(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return L(e).length;default:if(o)return G(e).length;t=(""+t).toLowerCase(),o=!0}}function y(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function m(e,t,n,o,r){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=u.from(t,o)),u.isBuffer(t))return 0===t.length?-1:v(e,t,n,o,r);if("number"==typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):v(e,[t],n,o,r);throw new TypeError("val must be string, number or Buffer")}function v(e,t,n,o,r){var i,s=1,a=e.length,u=t.length;if(o!==undefined&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;s=2,a/=2,u/=2,n/=2}function c(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(r){var l=-1;for(i=n;i<a;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*s}else-1!==l&&(i-=i-l),l=-1}else for(n+u>a&&(n=a-u),i=n;i>=0;i--){for(var f=!0,p=0;p<u;p++)if(c(e,i+p)!==c(t,p)){f=!1;break}if(f)return i}return-1}function g(e,t,n,o){n=Number(n)||0;var r=e.length-n;o?(o=Number(o))>r&&(o=r):o=r;var i=t.length;if(i%2!=0)throw new TypeError("Invalid hex string");o>i/2&&(o=i/2);for(var s=0;s<o;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function b(e,t,n,o){return q(G(t,e.length-n),e,n,o)}function E(e,t,n,o){return q(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function _(e,t,n,o){return E(e,t,n,o)}function S(e,t,n,o){return q(L(t),e,n,o)}function w(e,t,n,o){return q(function(e,t){for(var n,o,r,i=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),o=n>>8,r=n%256,i.push(r),i.push(o);return i}(t,e.length-n),e,n,o)}function O(e,t,n){return 0===t&&n===e.length?o.fromByteArray(e):o.fromByteArray(e.slice(t,n))}function M(e,t,n){n=Math.min(e.length,n);for(var o=[],r=t;r<n;){var i,s,a,u,c=e[r],l=null,f=c>239?4:c>223?3:c>191?2:1;if(r+f<=n)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(i=e[r+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[r+1],s=e[r+2],128==(192&i)&&128==(192&s)&&(u=(15&c)<<12|(63&i)<<6|63&s)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[r+1],s=e[r+2],a=e[r+3],128==(192&i)&&128==(192&s)&&128==(192&a)&&(u=(15&c)<<18|(63&i)<<12|(63&s)<<6|63&a)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),r+=f}return function(e){var t=e.length;if(t<=T)return String.fromCharCode.apply(String,e);var n="",o=0;for(;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=T));return n}(o)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=e.TYPED_ARRAY_SUPPORT!==undefined?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=s(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,o){return l(t),t<=0?a(e,t):n!==undefined?"string"==typeof o?a(e,t).fill(n,o):a(e,t).fill(n):a(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return f(null,e)},u.allocUnsafeSlow=function(e){return f(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,r=0,i=Math.min(n,o);r<i;++r)if(e[r]!==t[r]){n=e[r],o=t[r];break}return n<o?-1:o<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!i(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(t===undefined)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=u.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var s=e[n];if(!u.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,r),r+=s.length}return o},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?M(this,0,e):function(e,t,n){var o=!1;if((t===undefined||t<0)&&(t=0),t>this.length)return"";if((n===undefined||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return M(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return I(this,t,n);case"base64":return O(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,o,r){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(t===undefined&&(t=0),n===undefined&&(n=e?e.length:0),o===undefined&&(o=0),r===undefined&&(r=this.length),t<0||n>e.length||o<0||r>this.length)throw new RangeError("out of range index");if(o>=r&&t>=n)return 0;if(o>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,o>>>=0,r>>>=0,this===e)return 0;for(var i=r-o,s=n-t,a=Math.min(i,s),c=this.slice(o,r),l=e.slice(t,n),f=0;f<a;++f)if(c[f]!==l[f]){i=c[f],s=l[f];break}return i<s?-1:s<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},u.prototype.write=function(e,t,n,o){if(t===undefined)o="utf8",n=this.length,t=0;else if(n===undefined&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,o===undefined&&(o="utf8")):(o=n,n=undefined)}var r=this.length-t;if((n===undefined||n>r)&&(n=r),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var i=!1;;)switch(o){case"hex":return g(this,e,t,n);case"utf8":case"utf-8":return b(this,e,t,n);case"ascii":return E(this,e,t,n);case"latin1":case"binary":return _(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return w(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var T=4096;function k(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(127&e[r]);return o}function I(e,t,n){var o="";n=Math.min(e.length,n);for(var r=t;r<n;++r)o+=String.fromCharCode(e[r]);return o}function P(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var r="",i=t;i<n;++i)r+=B(e[i]);return r}function A(e,t,n){for(var o=e.slice(t,n),r="",i=0;i<o.length;i+=2)r+=String.fromCharCode(o[i]+256*o[i+1]);return r}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function R(e,t,n,o,r,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<i)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function N(e,t,n,o){t<0&&(t=65535+t+1);for(var r=0,i=Math.min(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(o?r:1-r))>>>8*(o?r:1-r)}function D(e,t,n,o){t<0&&(t=4294967295+t+1);for(var r=0,i=Math.min(e.length-n,4);r<i;++r)e[n+r]=t>>>8*(o?r:3-r)&255}function x(e,t,n,o,r,i){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(e,t,n,o,i){return i||x(e,0,n,4),r.write(e,t,n,o,23,4),n+4}function j(e,t,n,o,i){return i||x(e,0,n,8),r.write(e,t,n,o,52,8),n+8}u.prototype.slice=function(e,t){var n,o=this.length;if(e=~~e,t=t===undefined?o:~~t,e<0?(e+=o)<0&&(e=0):e>o&&(e=o),t<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var r=t-e;n=new u(r,undefined);for(var i=0;i<r;++i)n[i]=this[i+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var o=this[e+--t],r=1;t>0&&(r*=256);)o+=this[e+--t]*r;return o},u.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var o=this[e],r=1,i=0;++i<t&&(r*=256);)o+=this[e+i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*t)),o},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var o=t,r=1,i=this[e+--o];o>0&&(r*=256);)i+=this[e+--o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),r.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),r.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),r.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),r.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=1,i=0;for(this[t]=255&e;++i<n&&(r*=256);)this[t+i]=e/r&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,o){(e=+e,t|=0,n|=0,o)||R(this,e,t,n,Math.pow(2,8*n)-1,0);var r=n-1,i=1;for(this[t+r]=255&e;--r>=0&&(i*=256);)this[t+r]=e/i&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var i=0,s=1,a=0;for(this[t]=255&e;++i<n&&(s*=256);)e<0&&0===a&&0!==this[t+i-1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},u.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var r=Math.pow(2,8*n-1);R(this,e,t,n,r-1,-r)}var i=n-1,s=1,a=0;for(this[t+i]=255&e;--i>=0&&(s*=256);)e<0&&0===a&&0!==this[t+i+1]&&(a=1),this[t+i]=(e/s>>0)-a&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):N(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):N(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||R(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return U(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return U(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var r,i=o-n;if(this===e&&n<t&&t<o)for(r=i-1;r>=0;--r)e[r+t]=this[r+n];else if(i<1e3||!u.TYPED_ARRAY_SUPPORT)for(r=0;r<i;++r)e[r+t]=this[r+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+i),t);return i},u.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var r=e.charCodeAt(0);r<256&&(e=r)}if(o!==undefined&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!u.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=n===undefined?this.length:n>>>0,e||(e=0),"number"==typeof e)for(i=t;i<n;++i)this[i]=e;else{var s=u.isBuffer(e)?e:G(new u(e,o).toString()),a=s.length;for(i=0;i<n-t;++i)this[i+t]=s[i%a]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function G(e,t){var n;t=t||Infinity;for(var o=e.length,r=null,i=[],s=0;s<o;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(s+1===o){(t-=3)>-1&&i.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&i.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function L(e){return o.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function q(e,t,n,o){for(var r=0;r<o&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}}).call(this,n(28))},function(e,t,n){"use strict";var o,r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),i=64,s={},a=0,u=0;function c(e){var t="";do{t=r[e%i]+t,e=Math.floor(e/i)}while(e>0);return t}function l(){var e=c(+new Date);return e!==o?(a=0,o=e):e+"."+c(a++)}for(;u<i;u++)s[r[u]]=u;l.encode=c,l.decode=function(e){var t=0;for(u=0;u<e.length;u++)t=t*i+s[e.charAt(u)];return t},e.exports=l},function(e,t){var n=[].indexOf;e.exports=function(e,t){if(n)return e.indexOf(t);for(var o=0;o<e.length;++o)if(e[o]===t)return o;return-1}},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(26),i=n(13),s=n(85),a=n(50),u=n(51),c=(n(9)("socket.io-client:socket"),n(24)),l=n(45);e.exports=h;var f={connect:1,connect_error:1,connect_timeout:1,connecting:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1,ping:1,pong:1},p=i.prototype.emit;function h(e,t,n){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0,this.flags={},n&&n.query&&(this.query=n.query),this.io.autoConnect&&this.open()}i(h.prototype),h.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",u(this,"onopen")),a(e,"packet",u(this,"onpacket")),a(e,"close",u(this,"onclose"))]}},h.prototype.open=h.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"===this.io.readyState&&this.onopen(),this.emit("connecting"),this)},h.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},h.prototype.emit=function(e){if(f.hasOwnProperty(e))return p.apply(this,arguments),this;var t=s(arguments),n={type:(this.flags.binary!==undefined?this.flags.binary:l(t))?r.BINARY_EVENT:r.EVENT,data:t,options:{}};return n.options.compress=!this.flags||!1!==this.flags.compress,"function"==typeof t[t.length-1]&&(this.ids,this.acks[this.ids]=t.pop(),n.id=this.ids++),this.connected?this.packet(n):this.sendBuffer.push(n),this.flags={},this},h.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},h.prototype.onopen=function(){if("/"!==this.nsp)if(this.query){var e="object"===o(this.query)?c.encode(this.query):this.query;this.packet({type:r.CONNECT,query:e})}else this.packet({type:r.CONNECT})},h.prototype.onclose=function(e){this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},h.prototype.onpacket=function(e){var t=e.nsp===this.nsp,n=e.type===r.ERROR&&"/"===e.nsp;if(t||n)switch(e.type){case r.CONNECT:this.onconnect();break;case r.EVENT:case r.BINARY_EVENT:this.onevent(e);break;case r.ACK:case r.BINARY_ACK:this.onack(e);break;case r.DISCONNECT:this.ondisconnect();break;case r.ERROR:this.emit("error",e.data)}},h.prototype.onevent=function(e){var t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?p.apply(this,t):this.receiveBuffer.push(t)},h.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var o=s(arguments);t.packet({type:l(o)?r.BINARY_ACK:r.ACK,id:e,data:o})}}},h.prototype.onack=function(e){var t=this.acks[e.id];"function"==typeof t?(e.id,e.data,t.apply(this,e.data),delete this.acks[e.id]):e.id},h.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},h.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)p.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},h.prototype.ondisconnect=function(){this.nsp,this.destroy(),this.onclose("io server disconnect")},h.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},h.prototype.close=h.prototype.disconnect=function(){return this.connected&&(this.nsp,this.packet({type:r.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this},h.prototype.compress=function(e){return this.flags.compress=e,this},h.prototype.binary=function(e){return this.flags.binary=e,this}},function(e,t,n){"use strict";e.exports=function(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}},function(e,t){var n=[].slice;e.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var o=n.call(arguments,2);return function(){return t.apply(e,o.concat(n.call(arguments)))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoEasyDomainNumber=undefined;var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(87),s=(o=i)&&o.__esModule?o:{"default":o},a=n(53);var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"refreshNumber",value:function(){var t=e.GOEASY_DOMAIN_NUMBER,n=a.LocalStorageDispatcher.localStorage(),o=Math.floor(Math.random()*(s["default"].maxNumber-1)+1);return null!==n&&(o=parseInt(n.get(t))||o),o>0&&o<s["default"].maxNumber?o+=1:o==s["default"].maxNumber&&(o=1),null!==n&&n.put(t,o),o}}]),e}();u.GOEASY_DOMAIN_NUMBER="GOEASY_DOMAIN_NUMBER",t.GoEasyDomainNumber=u},function(e,t,n){"use strict";var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.LocalStorageDispatcher=void 0;var r=n(88),i=function(){function e(){this.domain=null;this.domain="undefined"!=typeof location&&/^(?:[A-za-z0-9-]+\.)+[A-za-z]{2,4}(?:[\/\?#][\/=\?%\-&~`@[\]\':+!\.#\w]*)?$/.test(location.host)?location.host.split(".").slice(-2).join("."):null}return e.prototype.get=function(e){var t=r.Cookie.get(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){var n=new Date(2030,12,31,0,0,0,0),o=this.domain;r.Cookie.set(e,JSON.stringify(t),n,o)},e.prototype.remove=function(e){var t=this.domain;r.Cookie.remove(e,t)},e.prototype.support=function(){return"undefined"!=typeof navigator&&!0===navigator.cookieEnabled},e}(),s=function(){function e(){}return e.prototype.get=function(e){var t=localStorage.getItem(e);return JSON.parse(t)},e.prototype.put=function(e,t){var n=localStorage.setItem(e,JSON.stringify(t));JSON.stringify(n)},e.prototype.remove=function(e){localStorage.removeItem(e)},e.prototype.support=function(){return!("undefined"!=typeof GameGlobal||"undefined"==typeof localStorage||!localStorage.setItem)},e}(),a=function(){function e(){}return e.prototype.get=function(e){var t=uni.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){uni.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){uni.removeStorageSync(e)},e.prototype.support=function(){return!("object"!=typeof uni||!uni.getStorageSync)},e}(),u=function(){function e(){}return e.prototype.get=function(e){var t=wx.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){wx.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){wx.removeStorageSync(e)},e.prototype.support=function(){return!("object"!=typeof wx||!wx.getStorageSync)},e}(),c=(function(){function e(){}e.prototype.get=function(e){var t=my.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){my.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){my.removeStorageSync(e)},e.prototype.support=function(){return!("undefined"==typeof my||!my.getStorageSync)}}(),function(){function e(){}e.prototype.get=function(e){var t=qq.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){qq.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){qq.removeStorageSync(e)},e.prototype.support=function(){return!("undefined"==typeof qq||!qq.getStorageSync)}}(),function(){function e(){}e.prototype.get=function(e){var t=tt.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){tt.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){tt.removeStorageSync(e)},e.prototype.support=function(){return!("object"!=typeof tt||!tt.getStorageSync)}}(),function(){function e(){}e.prototype.get=function(e){var t=swan.getStorageSync(e)||null;return JSON.parse(t)},e.prototype.put=function(e,t){swan.setStorageSync(e,JSON.stringify(t))},e.prototype.remove=function(e){swan.removeStorageSync(e)},e.prototype.support=function(){return!("undefined"==typeof swan||!swan.getStorageSync)}}(),function(){function e(){this.api=e.dispatch(),this.api}e.dispatch=function(){var e=new s,t=new i;return e.support()?e:t},e.prototype.get=function(e){return this.api.get(e)},e.prototype.put=function(e,t){this.api.put(e,t)},e.prototype.remove=function(e){this.api.remove(e)},e.prototype.support=function(){return"undefined"!=typeof localStorage}}(),function(){function e(){this.supportedStorage=null;var t=e.storages;t.push(new a),t.push(new s),t.push(new u),t.push(new i),this.dispatch(),this.supportedStorage}return e.localStorage=function(){return this.instance.supportedStorage},e.prototype.dispatch=function(){var t,n;try{for(var r=o(e.storages),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.support()){this.supportedStorage=s;break}}}catch(a){t={error:a}}finally{try{i&&!i.done&&(n=r["return"])&&n.call(r)}finally{if(t)throw t.error}}},e.storages=new Array,e.instance=new e,e}());t.LocalStorageDispatcher=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(99),s=n(103),a=(o=s)&&o.__esModule?o:{"default":o};var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.requestBuilder=null,this.fileUploader=i.fileUploader,this.requestBuilder=new a["default"]}return r(e,[{key:"upload",value:function(e,t,n,o){var r=this;return new Promise(function(i,s){r.requestBuilder.build(e,t,o).then(function(e){i(r.doUpload(e,n))})["catch"](function(e){s(e)})})}},{key:"customizeUpload",value:function(e,t){this.doUpload(e,t)}},{key:"doUpload",value:function(e,t){return this.fileUploader.upload(e,t)}}]),e}();t["default"]=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t["default"]=function o(e,t,n,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.host="",this.headers={},this.parameters={},this.file={},this.payload={},this.host=e,this.headers=t,this.parameters=n,this.file=r,this.payload=i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"build",value:function(e,t){}},{key:"newFileName",value:function(e){return e&&e.newFilename||""}}]),e}();t["default"]=r},function(e,t,n){"use strict";t.__esModule=!0,t.SocketEvents=void 0,function(e){e.IM_MESSAGE_RECEIVED="IM_MESSAGE_RECEIVED"}(t.SocketEvents||(t.SocketEvents={}))},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.PrivateMessage=void 0;var i=n(21),s=n(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.scene=function(){return s.Scene.PRIVATE},t.prototype.targetId=function(){return this.receiverId},t}(i.AbstractMessage);t.PrivateMessage=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.GroupMessage=void 0;var i=n(21),s=n(2),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.scene=function(){return s.Scene.GROUP},t.prototype.targetId=function(){return this.groupId},t}(i.AbstractMessage);t.GroupMessage=a},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.FileMessagePayloadImprover=void 0;var i=n(136),s=n(54),a=n(19),u=function(e){function t(){var t=e.call(this)||this;return t.goEasyUploader=new s["default"],t}return r(t,e),t.prototype.improve=function(e){var t=this,n=e.message;return new Promise(function(e,o){var r,i=n.buildOptions.createOptions;r=n.type===a.MessageType.VIDEO?n.payload.video.name:n.payload.name,t.goEasyUploader.upload(i.file,r,i.onProgress,n.type).then(function(o){t.setPayload(o,n),e()})["catch"](function(e){o(e)})})},t.prototype.setPayload=function(e,t){var n=e.content,o=void 0===n?{}:n;t.payload.url=o.url},t}(i.AbstractPayloadImprover);t.FileMessagePayloadImprover=u},function(e,t,n){"use strict";t.__esModule=!0,t.SortedInserter=void 0;var o=function(){function e(){}return e.prototype.insert=function(e,t){var n=this.binarySearch(e,t);if(n>=0)e.splice(n,1,t);else{var o=-n-1;e.splice(o,0,t)}},e.prototype.binarySearch=function(e,t){for(var n=0,o=e.length-1;n<=o;){var r=o+n>>1,i=this.compare(t,e[r]);if(i>0)n=r+1;else{if(!(i<0))return r;o=r-1}}return-n-1},e}();t.SortedInserter=o},function(e,t,n){"use strict";t.__esModule=!0;var o=n(6),r=n(21),i=n(0),s=n(2),a=n(149),u=n(3),c=n(1),l=n(4),f=n(5),p=n(8),h=n(17),d=function(){function e(){}return e.deleteServerMessages=function(e){var t=new a.DeleteMessageRequest(e);return t.times.length<0?Promise.resolve():new Promise(function(e,n){var r=new u["default"]({name:f.RocketTypes.IM_DELETE_MESSAGE,params:t,permission:c["default"].WRITE,singleTimeout:l.SocketTimeout.commonQuerySingle,totalTimeout:l.SocketTimeout.commonQueryTotal,success:function(t){200===t.code?e(t):n(t)},fail:function(e){n(e)}});o.im._goEasySocket.emit(r)})},e.validate=function(e){if(p.CallbackUtils.validateCallbackOptions(e),!i.calibrator.isArray(e.messages)||i.calibrator.isEmpty(e.messages))throw{code:400,content:"messages requires non empty array"};var t=e.messages;if(t.length>50)throw{code:400,content:"a maximum of 50 messages can be deleted at a time"};for(var n=h.Target.byIMMessage(t[0]),o=0;o<t.length;o++){var a=t[o];if(!(a instanceof r.AbstractMessage))throw{code:400,content:"message["+o+"] is not a correct message"};if(a.status===s.MessageStatus.SENDING)throw{code:400,content:"message["+o+"] is '"+a.status+"' and cannot be deleted"};if(o>0){var u=h.Target.byIMMessage(a);if(u.scene!==n.scene||u.id!==n.id)throw{code:400,content:"each message must be from the same friend or group"}}}},e}();t["default"]=d},function(e,t,n){"use strict";t.__esModule=!0;var o=n(2),r=n(6),i=function(){function e(){}return e.conversationId=function(e,t,n){var r=n;return e===o.Scene.PRIVATE&&(r=t+":"+n),r},e.targetId=function(e,t){if(e===o.Scene.PRIVATE){var n=t.split(":",2);return n[0]===r.IM.userId?n[1]:n[0]}return t},e}();t["default"]=i},function(e,t,n){"use strict";t.__esModule=!0;var o=n(6),r=n(2),i=n(155),s=n(3),a=n(1),u=n(4),c=n(21),l=n(0),f=n(5),p=n(8),h=n(17),d=function(){function e(){}return e.recallServerMessages=function(e){var t=new i.RecallMessageRequest(e);return 0===t.times.length?Promise.resolve():new Promise(function(e,n){var r=new s["default"]({name:f.RocketTypes.IM_RECALL_MESSAGE,params:t,permission:a["default"].WRITE,singleTimeout:u.SocketTimeout.commonRequestSingle,totalTimeout:u.SocketTimeout.commonRequestTotal,fail:function(e){n(e)},success:function(t){200===t.code?e(t):n(t)}});o.im._goEasySocket.emit(r)})},e.validate=function(e){p.CallbackUtils.validateCallbackOptions(e);var t,n=e.messages;if(!l.calibrator.isArray(n)||l.calibrator.isEmpty(n))throw{code:400,content:"messages requires non empty array"};if(n.length>50)throw{code:400,content:"a maximum of 50 messages can be recalled at a time"};for(var i=0;i<n.length;i++){var s=n[i];if(!(s instanceof c.AbstractMessage))throw{code:400,content:"message["+i+"] is an illegal message object"};if(s.status!==r.MessageStatus.SUCCESS)throw{code:400,content:"message["+i+"] is '"+s.status+"' and cannot be recalled"};if(s.recalled)throw{code:400,content:"message["+i+"] has been recalled"};if(s.senderId!==o.IM.userId)throw{code:400,content:"it is not allowed to recall messages sent by others"};if(i>0){var a=h.Target.byIMMessage(s);if(a.scene!==t.scene||a.id!==t.id)throw{code:400,content:"each message must be from the same friend or group"}}else t=h.Target.byIMMessage(s)}},e}();t["default"]=d},function(e,t,n){"use strict";t.__esModule=!0,t.PUBSUB_INTERNAL_EVENTS=void 0,function(e){e.MESSAGE_RECEIVED="PUBSUB_INTERNAL_MESSAGE_RECEIVED"}(t.PUBSUB_INTERNAL_EVENTS||(t.PUBSUB_INTERNAL_EVENTS={}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=function E(e,t,n){null===e&&(e=Function.prototype);var o=Object.getOwnPropertyDescriptor(e,t);if(o===undefined){var r=Object.getPrototypeOf(e);return null===r?undefined:E(r,t,n)}if("value"in o)return o.value;var i=o.get;return i===undefined?undefined:i.call(n)},i=g(n(40)),s=g(n(94)),a=g(n(3)),u=g(n(1)),c=g(n(12)),l=g(n(95)),f=n(0),p=(n(27),n(4)),h=g(n(2)),d=n(23),y=n(96),m=n(97),v=n(5);function g(e){return e&&e.__esModule?e:{"default":e}}var b=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.ioSocket=null,o.sid=null,o.appKey=null,o.anonymous=!1,o.userId=null,o.userData=null,o.otp=null,o.artifactVersion="0.0.0",o.uri=null,o.ioOpts=null,o.allowNotification=!1,o.reconnectingTimes=0,o.messageObservers={},o.connectFailedObservers=[],o.connectingObservers=[],o.expiredReconnectedObservers=[],o.onConnectSuccess=f.noop,o.onConnectFailed=f.noop,o.onConnectProgress=f.noop,o.setUriAndOpts(e),o.extendOptions(n),o.ioSocket=new s["default"]({onDisconnected:o.onIoDisconnected.bind(o),onReconnecting:o.onIoReconnecting.bind(o)}),o.ioSocket.addConnectedObserver(o.onIoReconnected.bind(o)),o.appKey=e.appkey,o.allowNotification=e.allowNotification,o.modules=e.modules,f.calibrator.isEmpty(n.id)?(o.anonymous=!0,o.userId=y.AnonymousUserIdRepository.get()):o.userId=n.id.toString(),o.artifactVersion=h["default"].version,o.addConnectedObserver(o.onConnectSuccess),o.addConnectFailedObserver(o.onConnectFailed),o.addConnectingObserver(o.onConnectProgress),o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i["default"]),o(t,[{key:"extendOptions",value:function(e){if(f.calibrator.isFunction(e.onSuccess)&&(this.onConnectSuccess=e.onSuccess),f.calibrator.isFunction(e.onFailed)&&(this.onConnectFailed=e.onFailed),f.calibrator.isFunction(e.onProgress)&&(this.onConnectProgress=e.onProgress),f.calibrator.isDef(e.data)&&!f.calibrator.isObject(e.data))throw{code:400,content:"TypeError: data requires an object."};if((f.calibrator.isDef(e.data)?String(e.data).length:0)>300){if(f.calibrator.isObject(e)&&f.calibrator.isFunction(e.onFailed))throw{code:400,content:"user.data-length limit 300 byte."}}else this.userData=e.data;this.otp=e.otp||null}},{key:"setUriAndOpts",value:function(e){var t=!0;if(d.PlatformDetector.currentPlatform()===d.Platform.BROWSER){var n="://"+f.GoEasyDomainNumber.refreshNumber()+e.host,o=void 0;!0===e.supportOldBrowser?(o=["polling","websocket"],t=!1):o=["websocket"],!1!==e.forceTLS&&t?this.uri="https"+n+":443":this.uri="http"+n+":80",this.ioOpts={transports:o,timeout:p.SocketTimeout.connect}}else this.uri="https://wx-"+e.host+":443",this.ioOpts={transports:["websocket"],reconnectionDelayMax:p.SocketTimeout.reconnectionDelayMax}}},{key:"onIoReconnected",value:function(){this.status===c["default"].RECONNECTING&&this.authorize()}},{key:"emit",value:function(e){r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"emit",this).call(this,e)}},{key:"doEmit",value:function(e,t,n){t.sid=this.sid,this.ioSocket.doEmit(e,t,n)}},{key:"sendAck",value:function(e,t){this.ioSocket.io.emit(e,t)}},{key:"connect",value:function(e){var n=this;r(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connect",this).call(this),this.onConnecting(this.reconnectingTimes),this.ioSocket.connect({uri:this.uri,opts:this.ioOpts}),e&&e.supportNotification()&&e.getRegIdPromise()?e.getRegIdPromise().then(function(e){n.regId=e,n.authorize()})["catch"](function(e){console.warn("Failed to register the Manufacturers Push service"+JSON.stringify(e)),n.authorize()}):this.authorize()}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t,n){var o=function(){e.status=c["default"].DISCONNECTED,e.ioSocket.disconnect(),t()};if(e.allowNotification){var r=new a["default"]({name:v.RocketTypes.manualDisconnect,params:{},permission:u["default"].READ,singleTimeout:p.SocketTimeout.commonRequestSingle,totalTimeout:p.SocketTimeout.commonRequestTotal,fail:function(e){n(e)},success:o});e.emit(r)}else o()})}},{key:"authorize",value:function(){var e={appkey:this.appKey,userId:this.userId,userData:JSON.stringify(this.userData),otp:this.otp,artifactVersion:this.artifactVersion,sid:this.sid,allowNT:this.allowNotification,regId:this.regId,modules:this.modules,a:this.anonymous,z:m.clientInfo.z};JSON.stringify(e);var t=new a["default"]({name:v.RocketTypes.authorize,params:e,permission:u["default"].NONE,singleTimeout:p.SocketTimeout.commonInfiniteSingle,totalTimeout:p.SocketTimeout.commonInfiniteTotal,success:this.onAuthorizeSuccess.bind(this),fail:this.onAuthorizeFailed.bind(this)});this.ioSocket.emit(t)}},{key:"onConnecting",value:function(){this.notify(this.connectingObservers,this.reconnectingTimes)}},{key:"onIoReconnecting",value:function(){this.reconnectingTimes++,this.status==c["default"].CONNECTED||this.status==c["default"].EXPIRED_RECONNECTED||this.status==c["default"].RECONNECTING?this.status=c["default"].RECONNECTING:this.status=c["default"].CONNECTING,this.onConnecting()}},{key:"onIoDisconnected",value:function(){this.status==c["default"].DISCONNECTING&&(this.status=c["default"].DISCONNECTED,this.notify(this.disconnectedObservers)),this.notify(this.disconnectedObservers)}},{key:"onAuthorizeSuccess",value:function(e){(!0===this.anonymous&&e.u&&(y.AnonymousUserIdRepository.put(e.u),this.userId=e.u),this.status===c["default"].RECONNECTING)?this.sid!==e.sid?(this.status=c["default"].EXPIRED_RECONNECTED,this.notify(this.expiredReconnectedObservers)):this.status=c["default"].RECONNECTED:(this.status=c["default"].CONNECTED,this.sid=e.sid);e.enablePublish&&(this.permissions.find(function(e){return e==u["default"].WRITE})||this.permissions.push(u["default"].WRITE)),e.enableSubscribe&&(this.permissions.find(function(e){return e==u["default"].READ})||this.permissions.push(u["default"].READ)),this.reconnectingTimes=0,this.notify(this.connectedObservers)}},{key:"onAuthorizeFailed",value:function(e){this.ioSocket.disconnect(),this.status=c["default"].CONNECT_FAILED;var t={code:e.resultCode||408,content:e.content||"Host unreachable or timeout"};this.notify(this.connectFailedObservers,t)}},{key:"addConnectingObserver",value:function(e){f.calibrator.isFunction(e)&&this.connectingObservers.push(e)}},{key:"addConnectFailedObserver",value:function(e){f.calibrator.isFunction(e)&&this.connectFailedObservers.push(e)}},{key:"addExpiredReconnectedObserver",value:function(e){f.calibrator.isFunction(e)&&this.expiredReconnectedObservers.push(e)}},{key:"addMessageObserver",value:function(e,t){var n=this;this.ioSocket.io.on(e,function(t){n.notifyMessageObservers(e,t)}),this.messageObservers[e]||(this.messageObservers[e]=[]),this.messageObservers[e].push(new l["default"](t))}},{key:"notifyMessageObservers",value:function(e,t){for(var n=this.messageObservers[e],o=0;o<n.length;o++)n[o].onMessage(e,t)}}]),t}();t["default"]=b},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(12),s=(o=i)&&o.__esModule?o:{"default":o};var a=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.socket=null,this.socket=t}return r(e,[{key:"emit",value:function(e){this.socket.status!==s["default"].CONNECT_FAILED&&this.socket.status!==s["default"].DISCONNECTED?(e.start(),this.doEmit(e)):e.fail({resultCode:"409",content:"Please connect first"})}},{key:"doEmit",value:function(e){var t=this;if(e.isTimeout())e.fail({resultCode:408,content:"Host unreachable or timeout"});else if(this.socket.status!==s["default"].CONNECT_FAILED)if(this.authenticated())if(this.hasPermission(e))if(this.socket.status===s["default"].CONNECTED||this.socket.status===s["default"].RECONNECTED||this.socket.status===s["default"].EXPIRED_RECONNECTED){if(!e.complete){var n=setTimeout(function(){t.doEmit(e)},e.singleTimeout);e.unique&&(e.params.retried=e.retried),this.socket.doEmit(e.name,e.params,function(t){clearTimeout(n),200===t.resultCode||200==t.code?e.success(t):e.fail(t)}),e.retried++}}else setTimeout(function(){t.doEmit(e)},500);else e.fail({resultCode:401,content:"No permission"});else setTimeout(function(){t.doEmit(e)},500);else e.fail({resultCode:408,content:"Failed to connect GoEasy."})}},{key:"hasPermission",value:function(e){return!!this.socket.permissions.find(function(t){return t===e.permission})}},{key:"authenticated",value:function(){return this.socket.status===s["default"].CONNECTED||this.socket.status===s["default"].RECONNECTING||this.socket.status===s["default"].RECONNECTED||this.socket.status===s["default"].EXPIRED_RECONNECTED}}]),e}();t["default"]=a},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(69),i=n(26),s=n(43);n(9)("socket.io-client");e.exports=t=u;var a=t.managers={};function u(e,t){"object"===(void 0===e?"undefined":o(e))&&(t=e,e=undefined),t=t||{};var n,i=r(e),u=i.source,c=i.id,l=i.path,f=a[c]&&l in a[c].nsps;return t.forceNew||t["force new connection"]||!1===t.multiplex||f?n=s(u,t):(a[c]||(a[c]=s(u,t)),n=a[c]),i.query&&!t.query&&(t.query=i.query),n.socket(i.path,t)}t.protocol=i.protocol,t.connect=u,t.Manager=n(43),t.Socket=n(49)},function(e,t,n){"use strict";var o=n(41);n(9)("socket.io-client:url");e.exports=function(e,t){var n=e;t=t||"undefined"!=typeof location&&location,null==e&&(e=t.protocol+"//"+t.host);"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?t.protocol+e:t.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==t?t.protocol+"//"+e:"https://"+e),n=o(e));n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443"));n.path=n.path||"/";var r=-1!==n.host.indexOf(":")?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+r+":"+n.port,n.href=n.protocol+"://"+r+(t&&t.port===n.port?"":":"+n.port),n}},function(e,t,n){"use strict";e.exports=n(71),e.exports.parser=n(14)},function(e,t,n){"use strict";var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(44),i=n(13),s=(n(9)("engine.io-client:socket"),n(48)),a=n(14),u=n(41),c=n(24);function l(e,t){if(!(this instanceof l))return new l(e,t);t=t||{},e&&"object"===(void 0===e?"undefined":o(e))&&(t=e,e=null),e?(e=u(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=u(t.host).host),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.agent=t.agent||!1,this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=c.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.transportOptions=t.transportOptions||{},this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.perMessageDeflate=!1!==t.perMessageDeflate&&(t.perMessageDeflate||{}),!0===this.perMessageDeflate&&(this.perMessageDeflate={}),this.perMessageDeflate&&null==this.perMessageDeflate.threshold&&(this.perMessageDeflate.threshold=1024),this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized===undefined||t.rejectUnauthorized,this.forceNode=!!t.forceNode,this.isReactNative="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase(),("undefined"==typeof self||this.isReactNative)&&(t.extraHeaders&&Object.keys(t.extraHeaders).length>0&&(this.extraHeaders=t.extraHeaders),t.localAddress&&(this.localAddress=t.localAddress)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingIntervalTimer=null,this.pingTimeoutTimer=null,this.open()}e.exports=l,l.priorWebsocketSuccess=!1,i(l.prototype),l.protocol=a.protocol,l.Socket=l,l.Transport=n(29),l.transports=n(44),l.parser=n(14),l.prototype.createTransport=function(e){var t=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}(this.query);t.EIO=a.protocol,t.transport=e;var n=this.transportOptions[e]||{};return this.id&&(t.sid=this.id),new r[e]({query:t,socket:this,agent:n.agent||this.agent,hostname:n.hostname||this.hostname,port:n.port||this.port,secure:n.secure||this.secure,path:n.path||this.path,forceJSONP:n.forceJSONP||this.forceJSONP,jsonp:n.jsonp||this.jsonp,forceBase64:n.forceBase64||this.forceBase64,enablesXDR:n.enablesXDR||this.enablesXDR,timestampRequests:n.timestampRequests||this.timestampRequests,timestampParam:n.timestampParam||this.timestampParam,policyPort:n.policyPort||this.policyPort,pfx:n.pfx||this.pfx,key:n.key||this.key,passphrase:n.passphrase||this.passphrase,cert:n.cert||this.cert,ca:n.ca||this.ca,ciphers:n.ciphers||this.ciphers,rejectUnauthorized:n.rejectUnauthorized||this.rejectUnauthorized,perMessageDeflate:n.perMessageDeflate||this.perMessageDeflate,extraHeaders:n.extraHeaders||this.extraHeaders,forceNode:n.forceNode||this.forceNode,localAddress:n.localAddress||this.localAddress,requestTimeout:n.requestTimeout||this.requestTimeout,protocols:n.protocols||void 0,isReactNative:this.isReactNative})},l.prototype.open=function(){var e;if(this.rememberUpgrade&&l.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},l.prototype.setTransport=function(e){e.name;var t=this;this.transport&&(this.transport.name,this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},l.prototype.probe=function(e){var t=this.createTransport(e,{probe:1}),n=!1,o=this;function r(){if(o.onlyBinaryUpgrades){var e=!this.supportsBinary&&o.transport.supportsBinary;n=n||e}n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",function(e){if(!n)if("pong"===e.type&&"probe"===e.data){if(o.upgrading=!0,o.emit("upgrading",t),!t)return;l.priorWebsocketSuccess="websocket"===t.name,o.transport.name,o.transport.pause(function(){n||"closed"!==o.readyState&&(f(),o.setTransport(t),t.send([{type:"upgrade"}]),o.emit("upgrade",t),t=null,o.upgrading=!1,o.flush())})}else{var r=new Error("probe error");r.transport=t.name,o.emit("upgradeError",r)}}))}function i(){n||(n=!0,f(),t.close(),t=null)}function s(e){var n=new Error("probe error: "+e);n.transport=t.name,i(),o.emit("upgradeError",n)}function a(){s("transport closed")}function u(){s("socket closed")}function c(e){t&&e.name!==t.name&&(e.name,t.name,i())}function f(){t.removeListener("open",r),t.removeListener("error",s),t.removeListener("close",a),o.removeListener("close",u),o.removeListener("upgrading",c)}l.priorWebsocketSuccess=!1,t.once("open",r),t.once("error",s),t.once("close",a),this.once("close",u),this.once("upgrading",c),t.open()},l.prototype.onOpen=function(){if(this.readyState="open",l.priorWebsocketSuccess="websocket"===this.transport.name,this.emit("open"),this.flush(),"open"===this.readyState&&this.upgrade&&this.transport.pause)for(var e=0,t=this.upgrades.length;e<t;e++)this.probe(this.upgrades[e])},l.prototype.onPacket=function(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(e.type,e.data,this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"pong":this.setPing(),this.emit("pong");break;case"error":var t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else this.readyState},l.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!==this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},l.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!==t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},l.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){e.pingTimeout,e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},l.prototype.ping=function(){var e=this;this.sendPacket("ping",function(){e.emit("ping")})},l.prototype.onDrain=function(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emit("drain"):this.flush()},l.prototype.flush=function(){"closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(this.writeBuffer.length,this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},l.prototype.write=l.prototype.send=function(e,t,n){return this.sendPacket("message",e,t,n),this},l.prototype.sendPacket=function(e,t,n,o){if("function"==typeof t&&(o=t,t=undefined),"function"==typeof n&&(o=n,n=null),"closing"!==this.readyState&&"closed"!==this.readyState){(n=n||{}).compress=!1!==n.compress;var r={type:e,data:t,options:n};this.emit("packetCreate",r),this.writeBuffer.push(r),o&&this.once("flush",o),this.flush()}},l.prototype.close=function(){if("opening"===this.readyState||"open"===this.readyState){this.readyState="closing";var e=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?o():t()}):this.upgrading?o():t()}function t(){e.onClose("forced close"),e.transport.close()}function n(){e.removeListener("upgrade",n),e.removeListener("upgradeError",n),t()}function o(){e.once("upgrade",n),e.once("upgradeError",n)}return this},l.prototype.onError=function(e){l.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},l.prototype.onClose=function(e,t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState){clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t),this.writeBuffer=[],this.prevBufferLen=0}},l.prototype.filterUpgrades=function(e){for(var t=[],n=0,o=e.length;n<o;n++)~s(this.transports,e[n])&&t.push(e[n]);return t}},function(e,t,n){"use strict";(function(t){var o=n(73),r=n(30);e.exports=l;var i,s=/\n/g,a=/\\n/g;function u(){}function c(){return"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:{}}function l(e){if(o.call(this,e),this.query=this.query||{},!i){var t=c();i=t.___eio=t.___eio||[]}this.index=i.length;var n=this;i.push(function(e){n.onData(e)}),this.query.j=this.index,"function"==typeof addEventListener&&addEventListener("beforeunload",function(){n.script&&(n.script.onerror=u)},!1)}r(l,o),l.prototype.supportsBinary=!1,l.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),o.prototype.doClose.call(this)},l.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n?n.parentNode.insertBefore(t,n):(document.head||document.body).appendChild(t),this.script=t,"undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent)&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},l.prototype.doWrite=function(e,t){var n=this;if(!this.form){var o,r=document.createElement("form"),i=document.createElement("textarea"),u=this.iframeId="eio_iframe_"+this.index;r.className="socketio",r.style.position="absolute",r.style.top="-1000px",r.style.left="-1000px",r.target=u,r.method="POST",r.setAttribute("accept-charset","utf-8"),i.name="d",r.appendChild(i),document.body.appendChild(r),this.form=r,this.area=i}function c(){l(),t()}function l(){if(n.iframe)try{n.form.removeChild(n.iframe)}catch(t){n.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+n.iframeId+'">';o=document.createElement(e)}catch(t){(o=document.createElement("iframe")).name=n.iframeId,o.src="javascript:0"}o.id=n.iframeId,n.form.appendChild(o),n.iframe=o}this.form.action=this.uri(),l(),e=e.replace(a,"\\\n"),this.area.value=e.replace(s,"\\n");try{this.form.submit()}catch(f){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"===n.iframe.readyState&&c()}:this.iframe.onload=c}}).call(this,n(28))},function(e,t,n){"use strict";var o=n(29),r=n(24),i=n(14),s=n(30),a=n(47);n(9)("engine.io-client:polling");e.exports=c;var u=null!=new(n(81))({xdomain:!1}).responseType;function c(e){var t=e&&e.forceBase64;u&&!t||(this.supportsBinary=!1),o.call(this,e)}s(c,o),c.prototype.name="polling",c.prototype.doOpen=function(){this.poll()},c.prototype.pause=function(e){var t=this;function n(){t.readyState="paused",e()}if(this.readyState="pausing",this.polling||!this.writable){var o=0;this.polling&&(o++,this.once("pollComplete",function(){--o||n()})),this.writable||(o++,this.once("drain",function(){--o||n()}))}else n()},c.prototype.poll=function(){this.polling=!0,this.doPoll(),this.emit("poll")},c.prototype.onData=function(e){var t=this;i.decodePayload(e,this.socket.binaryType,function(e,n,o){if("opening"===t.readyState&&t.onOpen(),"close"===e.type)return t.onClose(),!1;t.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"===this.readyState?this.poll():this.readyState)},c.prototype.doClose=function(){var e=this;function t(){e.write([{type:"close"}])}"open"===this.readyState?t():this.once("open",t)},c.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")};i.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},c.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=a()),this.supportsBinary||e.sid||(e.b64=1),e=r.encode(e),this.port&&("https"===t&&443!==Number(this.port)||"http"===t&&80!==Number(this.port))&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e}},function(e,t,n){"use strict";e.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var o in e)n.call(e,o)&&t.push(o);return t}},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],o=t[1];return 3*(n+o)/4-o},t.toByteArray=function(e){var t,n,o=c(e),s=o[0],a=o[1],u=new i(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),l=0,f=a>0?s-4:s;for(n=0;n<f;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,i=[],s=0,a=n-r;s<a;s+=16383)i.push(l(e,s,s+16383>a?a:s+16383));1===r?(t=e[n-1],i.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],i.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return i.join("")};for(var o=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,u=s.length;a<u;++a)o[a]=s[a],r[s.charCodeAt(a)]=a;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var r,i,s=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(o[(i=r)>>18&63]+o[i>>12&63]+o[i>>6&63]+o[63&i]);return s.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,o,r){var i,s,a=8*r-o-1,u=(1<<a)-1,c=u>>1,l=-7,f=n?r-1:0,p=n?-1:1,h=e[t+f];for(f+=p,i=h&(1<<-l)-1,h>>=-l,l+=a;l>0;i=256*i+e[t+f],f+=p,l-=8);for(s=i&(1<<-l)-1,i>>=-l,l+=o;l>0;s=256*s+e[t+f],f+=p,l-=8);if(0===i)i=1-c;else{if(i===u)return s?NaN:(h?-1:1)*Infinity;s+=Math.pow(2,o),i-=c}return(h?-1:1)*s*Math.pow(2,i-o)},t.write=function(e,t,n,o,r,i){var s,a,u,c=8*i-r-1,l=(1<<c)-1,f=l>>1,p=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:i-1,d=o?1:-1,y=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===Infinity?(a=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),(t+=s+f>=1?p/u:p*Math.pow(2,1-f))*u>=2&&(s++,u/=2),s+f>=l?(a=0,s=l):s+f>=1?(a=(t*u-1)*Math.pow(2,r),s+=f):(a=t*Math.pow(2,f-1)*Math.pow(2,r),s=0));r>=8;e[n+h]=255&a,h+=d,a/=256,r-=8);for(s=s<<r|a,c+=r;c>0;e[n+h]=255&s,h+=d,s/=256,c-=8);e[n+h-d]|=128*y}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t){function n(){}e.exports=function(e,t,o){var r=!1;return o=o||n,i.count=e,0===e?t():i;function i(e,n){if(i.count<=0)throw new Error("after called too many times");--i.count,e?(r=!0,t(e),t=o):0!==i.count||r||t(null,n)}}},function(e,t,n){"use strict";var o,r,i,s=String.fromCharCode;function a(e){for(var t,n,o=[],r=0,i=e.length;r<i;)(t=e.charCodeAt(r++))>=55296&&t<=56319&&r<i?56320==(64512&(n=e.charCodeAt(r++)))?o.push(((1023&t)<<10)+(1023&n)+65536):(o.push(t),r--):o.push(t);return o}function u(e,t){if(e>=55296&&e<=57343){if(t)throw Error("Lone surrogate U+"+e.toString(16).toUpperCase()+" is not a scalar value");return!1}return!0}function c(e,t){return s(e>>t&63|128)}function l(e,t){if(0==(4294967168&e))return s(e);var n="";return 0==(4294965248&e)?n=s(e>>6&31|192):0==(4294901760&e)?(u(e,t)||(e=65533),n=s(e>>12&15|224),n+=c(e,6)):0==(4292870144&e)&&(n=s(e>>18&7|240),n+=c(e,12),n+=c(e,6)),n+=s(63&e|128)}function f(){if(i>=r)throw Error("Invalid byte index");var e=255&o[i];if(i++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function p(e){var t,n;if(i>r)throw Error("Invalid byte index");if(i==r)return!1;if(t=255&o[i],i++,0==(128&t))return t;if(192==(224&t)){if((n=(31&t)<<6|f())>=128)return n;throw Error("Invalid continuation byte")}if(224==(240&t)){if((n=(15&t)<<12|f()<<6|f())>=2048)return u(n,e)?n:65533;throw Error("Invalid continuation byte")}if(240==(248&t)&&(n=(7&t)<<18|f()<<12|f()<<6|f())>=65536&&n<=1114111)return n;throw Error("Invalid UTF-8 detected")}e.exports={version:"2.1.2",encode:function(e,t){for(var n=!1!==(t=t||{}).strict,o=a(e),r=o.length,i=-1,s="";++i<r;)s+=l(o[i],n);return s},decode:function(e,t){var n=!1!==(t=t||{}).strict;o=a(e),r=o.length,i=0;for(var u,c=[];!1!==(u=p(n));)c.push(u);return function(e){for(var t,n=e.length,o=-1,r="";++o<n;)(t=e[o])>65535&&(r+=s((t-=65536)>>>10&1023|55296),t=56320|1023&t),r+=s(t);return r}(c)}}},function(e,t){var n=void 0!==n?n:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder&&MozBlobBuilder,o=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),r=o&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),i=n&&n.prototype.append&&n.prototype.getBlob;function s(e){return e.map(function(e){if(e.buffer instanceof ArrayBuffer){var t=e.buffer;if(e.byteLength!==t.byteLength){var n=new Uint8Array(e.byteLength);n.set(new Uint8Array(t,e.byteOffset,e.byteLength)),t=n.buffer}return t}return e})}function a(e,t){t=t||{};var o=new n;return s(e).forEach(function(e){o.append(e)}),t.type?o.getBlob(t.type):o.getBlob()}function u(e,t){return new Blob(s(e),t||{})}"undefined"!=typeof Blob&&(a.prototype=Blob.prototype,u.prototype=Blob.prototype),e.exports=o?r?Blob:u:i?a:undefined},function(e,t,n){"use strict";var o=n(82);e.exports=function(e){var t=e.xdomain,n=e.xscheme,r=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||o))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&r)return new XDomainRequest}catch(i){}if(!t)try{return new(self[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(i){}}},function(e,t){try{e.exports="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(n){e.exports=!1}},function(e,t,n){"use strict";(function(t){var o,r,i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(29),a=n(14),u=n(24),c=n(30),l=n(47);n(9)("engine.io-client:websocket");if("undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket)if("undefined"!=typeof WebSocket)o=WebSocket;else if("undefined"!=typeof self)o=self.WebSocket||self.MozWebSocket;else try{r=n(84)}catch(h){}var f=o||r;function p(e){e&&e.forceBase64&&(this.supportsBinary=!1),("undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket)&&(this.perMessageDeflate=e.perMessageDeflate,this.usingBrowserWebSocket=o&&!e.forceNode,this.protocols=e.protocols,this.usingBrowserWebSocket||(f=r)),s.call(this,e)}("undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket)&&"undefined"==typeof GameGlobal||(f=function(e){var t=this;if(t.onopen=function(){},t.onclose=function(){},t.onmessage=function(e){},t.onerror=function(e){},"object"===("undefined"==typeof tt?"undefined":i(tt))&&tt.getSystemInfo){var n=tt.connectSocket({url:e});t.send=function(e){n.send({data:e})},t.close=function(){n.close()},n.onOpen(function(){t.onopen()}),n.onError(function(e){t.onerror(e)}),n.onMessage(function(e){t.onmessage(e)}),n.onClose(function(){t.onclose()})}else if("undefined"!=typeof uni){var o=uni.connectSocket({url:e,complete:function(){}});t.send=function(e){o.send({data:e})},t.close=function(){o.close()},o.onOpen(function(e){t.onopen()}),o.onError(function(e){t.onerror(e)}),o.onMessage(function(e){t.onmessage(e)}),o.onClose(function(e){t.onclose()})}else{var r=wx.connectSocket({url:e});t.send=function(e){r.send({data:e})},t.close=function(e){r.close({code:1e3})},r.onOpen(function(){t.onopen()}),r.onError(function(e){t.onerror(e)}),r.onMessage(function(e){t.onmessage(e)}),r.onClose(function(e){t.onclose(e)})}}),e.exports=p,c(p,s),p.prototype.name="websocket",p.prototype.supportsBinary=!1,p.prototype.doOpen=function(){if(this.check()){var e,t,n=this.uri();("undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket)&&(e=this.protocols),(t="undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket?{agent:this.agent,perMessageDeflate:this.perMessageDeflate}:{agent:this.agent}).pfx=this.pfx,t.key=this.key,t.passphrase=this.passphrase,t.cert=this.cert,t.ca=this.ca,t.ciphers=this.ciphers,t.rejectUnauthorized=this.rejectUnauthorized,this.extraHeaders&&(t.headers=this.extraHeaders),this.localAddress&&(t.localAddress=this.localAddress);try{"undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket?this.ws=this.usingBrowserWebSocket&&!this.isReactNative?e?new f(n,e):new f(n):new f(n,e,t):this.ws=new f(n)}catch(o){return this.emit("error",o)}this.ws.binaryType===undefined&&(this.supportsBinary=!1),this.ws.supports&&this.ws.supports.binary?(this.supportsBinary=!0,this.ws.binaryType="nodebuffer"):this.ws.binaryType="arraybuffer",this.addEventListeners()}},p.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},p.prototype.write=function(e){var n=this;this.writable=!1;for(var o=e.length,r=0,i=o;r<i;r++)!function(e){a.encodePacket(e,n.supportsBinary,function(r){if("undefined"==typeof uni&&"undefined"==typeof wx||"undefined"!=typeof WebSocket){if(!n.usingBrowserWebSocket){var i={};if(e.options&&(i.compress=e.options.compress),n.perMessageDeflate)("string"==typeof r?t.byteLength(r):r.length)<n.perMessageDeflate.threshold&&(i.compress=!1)}try{n.usingBrowserWebSocket?n.ws.send(r):n.ws.send(r,i)}catch(h){}}else try{n.ws.send(r)}catch(h){}--o||s()})}(e[r]);function s(){n.emit("flush"),setTimeout(function(){n.writable=!0,n.emit("drain")},0)}},p.prototype.onClose=function(){s.prototype.onClose.call(this)},p.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},p.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"===t&&443!==Number(this.port)||"ws"===t&&80!==Number(this.port))&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=l()),this.supportsBinary||(e.b64=1),(e=u.encode(e)).length&&(e="?"+e),t+"://"+(-1!==this.hostname.indexOf(":")?"["+this.hostname+"]":this.hostname)+n+this.path+e},p.prototype.check=function(){return!(!f||"__initialize"in f&&this.name===p.prototype.name)}}).call(this,n(46).Buffer)},function(e,t){},function(e,t){e.exports=function(e,t){for(var n=[],o=(t=t||0)||0;o<e.length;o++)n[o-t]=e[o];return n}},function(e,t){function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}e.exports=n,n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={maxNumber:5}},function(e,t,n){"use strict";var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0,t.Cookie=void 0;var r=function(){function e(){}return e.get=function(e){var t,n,r=encodeURIComponent(e)+"=",i=document.cookie.split("; ");try{for(var s=o(i),a=s.next();!a.done;a=s.next()){var u=a.value;if(u.startsWith(r))return decodeURIComponent(u.substring(r.length))}}catch(c){t={error:c}}finally{try{a&&!a.done&&(n=s["return"])&&n.call(s)}finally{if(t)throw t.error}}return null},e.set=function(e,t,n,o,r,i){void 0===r&&(r="/"),void 0===i&&(i=!1);var s=encodeURIComponent(e)+"="+encodeURIComponent(t);n instanceof Date&&(s+="; expires="+n.toGMTString()),r&&(s+="; path="+r),o&&(s+="; domain="+o),i&&(s+="; secure"),document.cookie=s},e.remove=function(t,n,o,r){void 0===o&&(o="/"),void 0===r&&(r=!1),e.set(t,"",new Date(0),n,o,r)},e}();t.Cookie=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UUID=undefined;var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(90),s=(o=i)&&o.__esModule?o:{"default":o};var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"get",value:function(){return(0,s["default"])().replace(/-/g,"")}}]),e}();t.UUID=a},function(e,t,n){var o,r,i=n(91),s=n(92),a=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],f=(e=e||{}).node||o,p=e.clockseq!==undefined?e.clockseq:r;if(null==f||null==p){var h=i();null==f&&(f=o=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==p&&(p=r=16383&(h[6]<<8|h[7]))}var d=e.msecs!==undefined?e.msecs:(new Date).getTime(),y=e.nsecs!==undefined?e.nsecs:u+1,m=d-a+(y-u)/1e4;if(m<0&&e.clockseq===undefined&&(p=p+1&16383),(m<0||d>a)&&e.nsecs===undefined&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");a=d,u=y,r=p;var v=(1e4*(268435455&(d+=122192928e5))+y)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var g=d/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=p>>>8|128,l[c++]=255&p;for(var b=0;b<6;++b)l[c+b]=f[b];return t||s(l)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,r=n;return[r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,Array),o(t,[{key:"deleteByKey",value:function(e,t,n){var o=e.findIndex(function(e){return e[t]==n});o>-1&&e.splice(o,1)}},{key:"unshiftGuid",value:function(e){var t=!1,n=this.findIndex(function(t){return t==e});for(n>-1&&(t=!0,this.splice(n,1)),this.unshift(e);this.length>300;)this.pop();return t}}]),t}());t.goEasyArray=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=s(n(40)),i=s(n(12));function s(e){return e&&e.__esModule?e:{"default":e}}var a=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.reconnectingObservers=[],n.addReconnectingObserver(e.onReconnecting),n.addDisconnectedObserver(e.onDisconnected),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r["default"]),o(t,[{key:"connect",value:function(e){(function n(e,t,o){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(r===undefined){var i=Object.getPrototypeOf(e);return null===i?undefined:n(i,t,o)}if("value"in r)return r.value;var s=r.get;return s===undefined?undefined:s.call(o)})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connect",this).call(this),this.io=this.io.connect(e.uri,e.opts),this.initListener()}},{key:"doEmit",value:function(e,t,n){this.io.emit(e,t,n)}},{key:"initListener",value:function(){var e=this;this.io.on("reconnecting",function(t){e.status=i["default"].CONNECTING,e.notify(e.reconnectingObservers,t)}),this.io.on("connect",function(){e.status=i["default"].CONNECTED,e.notify(e.connectedObservers)}),this.io.on("disconnect",function(){e.status=i["default"].DISCONNECTED,e.notify(e.disconnectedObservers)}),this.io.on("connect_error",function(e){})}},{key:"addReconnectingObserver",value:function(e){this.reconnectingObservers.push(e)}}]),t}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0);var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.callback=r.noop,this.guidList=[],this.callback=t}return o(e,[{key:"onMessage",value:function(e,t){if("string"==typeof t&&(t=JSON.parse(t)),t.i){if(this.guidList.findIndex(function(e){return e===t.i})>-1)return;this.guidList.unshift(t.i),this.guidList.length>300&&this.guidList.pop()}this.callback(t)}}]),e}();t["default"]=i},function(e,t,n){"use strict";t.__esModule=!0,t.AnonymousUserIdRepository=void 0;var o=n(0),r=n(53),i=function(){function e(){}return e.get=function(){var t=e.storage;if(null!==t){var n=t.get(e.ANONYMOUS_USER_ID_KEY);if(!o.calibrator.isEmpty(n))return n.toString()}return null},e.put=function(t){var n=e.storage;null!==n&&n.put(e.ANONYMOUS_USER_ID_KEY,t.toString())},e.storage=r.LocalStorageDispatcher.localStorage(),e.ANONYMOUS_USER_ID_KEY="goeasy-anonymous-user-id",e}();t.AnonymousUserIdRepository=i},function(e,t,n){"use strict";t.__esModule=!0,t.clientInfo=void 0;var o=n(23),r=n(18),i=new(function(){function e(){this.platform=o.PlatformDetector.currentPlatform(),this.framework=r.FrameworkDetector.currentFramework(),this.z=this.toZ()}return e.prototype.toZ=function(){for(var e=JSON.stringify({platform:this.platform,framework:this.framework}),t="",n=0;n<e.length;n++){var o=e.charCodeAt(n);t+=String.fromCharCode(o+5)}return t},e}());t.clientInfo=i},function(e,t,n){"use strict";t.__esModule=!0,t.ModuleTypes=void 0,t.ModuleTypes={IM:"IM",PUBSUB:"PUBSUB"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fileUploader=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(100),i=n(101),s=n(102),a=n(18);function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=new(function(){function e(){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploader=(u(t={},a.Framework.UNIAPP,r.uniAppFileUploader),u(t,a.Framework.NATIVE_APPLET_WX,i.wxFileUploader),u(t,a.Framework.UNKNOWN,s.htmlFileUploader),t)}return o(e,[{key:"upload",value:function(e,t){var n=a.FrameworkDetector.currentFramework();return this.uploader[n].upload(e,t)}}]),e}());t.fileUploader=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.uniAppFileUploader=undefined;var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(32),s=(o=i)&&o.__esModule?o:{"default":o};var a=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s["default"]),r(t,[{key:"upload",value:function(e,t){var n=this;try{return new Promise(function(o,r){uni.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(t){if(200===t.statusCode){var n=e.payload;n.message=t.errMsg,o({code:200,content:n})}else r({code:t.statusCode,content:t.errMsg})},fail:function(e){r({code:500,content:e.errMsg})}}).onProgressUpdate(function(e){t&&t(e)})})}catch(o){return new Promise(function(e,t){t({code:500,content:o})})}}},{key:"getTempFilePath",value:function(e){var t=e.file;return t.tempFilePath||t.fullPath||t.path}}]),t}());t.uniAppFileUploader=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wxFileUploader=undefined;var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(32),s=(o=i)&&o.__esModule?o:{"default":o};var a=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s["default"]),r(t,[{key:"upload",value:function(e,t){var n=this;try{return new Promise(function(o,r){wx.uploadFile({url:e.host,filePath:n.getTempFilePath(e),name:"file",formData:e.parameters,success:function(t){if(200===t.statusCode){var n=e.payload;n.message=t.errMsg,o({code:200,content:n})}else r({code:t.statusCode,content:t.errMsg})},fail:function(e){r({code:500,content:e.errMsg})}}).onProgressUpdate(function(e){t&&t(e)})})}catch(o){return new Promise(function(e,t){t({code:500,content:o})})}}},{key:"getTempFilePath",value:function(e){var t=e.file||e.fileRes;return t.path||t.tempFilePath}}]),t}());t.wxFileUploader=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.htmlFileUploader=undefined;var o,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=n(32),s=(o=i)&&o.__esModule?o:{"default":o};var a=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s["default"]),r(t,[{key:"upload",value:function(e,t){try{return new Promise(function(n,o){var r=new XMLHttpRequest;for(var i in r.open("post",e.host,!0),e.headers)r.setRequestHeader(i,e.headers[i]);r.upload.onprogress=function(e){t&&t(e)},r.upload.onloadstart=function(e){t&&t(e)},r.upload.onloadend=function(e){t&&t(e)};var s=new FormData;for(var a in e.parameters)"fileRes"==a?s.append("file",e.parameters[a]):s.append(a,e.parameters[a]);r.send(s),r.onreadystatechange=function(){if(4==r.readyState)if(r.status>=200&&r.status<300||304==r.status){var t=e.payload;t.message=r.responseText,n({code:200,content:t})}else o({code:r.status,content:r.responseText})}})}catch(n){return new Promise(function(e,t){t({code:500,content:n})})}}}]),t}());t.htmlFileUploader=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=s(n(104)),i=s(n(108));function s(e){return e&&e.__esModule?e:{"default":e}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.uploadTokenResolver=null,this.uploadTokenResolver=new i["default"]}return o(e,[{key:"build",value:function(e,t,n){var o=this;return new Promise(function(i,s){o.uploadTokenResolver.resolve(t).then(function(t){var o=t.content;i(new r["default"](o.vendor).build(o,e,n))})["catch"](function(e){s(e)})})}}]),e}();t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(105),r=n(106),i=n(107);t["default"]=function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),e==o.OssType.aliYun?r.aliYunOSSRequestBuilder:i.qiNiuYunOSSRequestBuilder}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OssType={aliYun:"ALI",qiNiu:"QN"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aliYunOSSRequestBuilder=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=a(n(55)),i=a(n(56)),s=n(19);function a(e){return e&&e.__esModule?e:{"default":e}}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i["default"]),o(t,[{key:"url",value:function(e){return e.host+"/"+e.dir+"/"+this.newFileName(e)}},{key:"build",value:function(e,t,n){var o={key:e.dir+"/"+this.newFileName(e),OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200",fileRes:t};s.MessageType.FILE===n&&(o={key:e.dir+"/"+this.newFileName(e),OSSAccessKeyId:e.accessKeyId,policy:e.policy,signature:e.signature,success_action_status:"200","Content-Disposition":"attachment;filename="+t.name,fileRes:t});var i={newFileName:this.newFileName(e),url:this.url(e)};return new r["default"](e.host,null,o,t,i)}}]),t}();t["default"]=u;var c=new u;t.aliYunOSSRequestBuilder=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.qiNiuYunOSSRequestBuilder=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=s(n(56)),i=s(n(55));function s(e){return e&&e.__esModule?e:{"default":e}}var a=new(function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r["default"]),o(t,[{key:"url",value:function(e){return e.downloadUrl}},{key:"build",value:function(e,t){var n={key:this.newFileName(e),token:e.token,file:t},o={newFileName:this.newFileName(e),url:this.url(e)};return new i["default"](e.host,null,n,t,o)}}]),t}());t.qiNiuYunOSSRequestBuilder=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=u(n(3)),i=u(n(1)),s=n(4),a=n(6);function u(e){return e&&e.__esModule?e:{"default":e}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"resolve",value:function(e){return new Promise(function(t,n){var o=new r["default"]({name:"uploadToken",params:{filename:e},permission:i["default"].WRITE,singleTimeout:s.SocketTimeout.commonRequestSingle,totalTimeout:s.SocketTimeout.commonRequestTotal,fail:function(e){n(e)},success:function(e){200===e.code?t(e):n(e)}});a.im._goEasySocket.emit(o)})}}]),e}();t["default"]=c},function(e,t,n){"use strict";t.__esModule=!0;var o=n(3),r=n(1),i=n(4),s=n(0),a=n(6),u=n(5),c=function(){function e(){}return e.prototype.subscribe=function(e){var t=e.groupIds;return new Promise(function(n,c){if(Array.isArray(t)&&0!=t.length){for(var l=0;l<t.length;l++){if(!s.calibrator.isStringOrNumber(t[l]))return void c({code:400,content:"TypeError: groups item require string or number."});s.calibrator.isNumber(t[l])&&(t[l]=t[l].toString())}var f=new o["default"]({name:u.RocketTypes.subscribeGroups,params:{groupIds:t,at:e.accessToken},permission:r["default"].WRITE,singleTimeout:i.SocketTimeout.commonInfiniteSingle,totalTimeout:i.SocketTimeout.commonInfiniteTotal,success:function(){n({code:200,content:"ok"})},fail:function(e){c({code:e.resultCode||408,content:e.content||"Failed to subscribe group message"})}});a.im._goEasySocket.emit(f)}else c({code:400,content:"TypeError: groups require array."})})},e.prototype.unsubscribe=function(e){return new Promise(function(t,n){if(s.calibrator.isStringOrNumber(e)){e=e.toString();var c=new o["default"]({name:u.RocketTypes.unsubscribeGroup,params:{groupId:e},permission:r["default"].READ,singleTimeout:i.SocketTimeout.commonRequestSingle,totalTimeout:i.SocketTimeout.commonRequestTotal,success:function(){t({code:200,content:"ok"})},fail:function(e){n({code:e.resultCode||408,content:e.content||"Failed to unsubscribe group message"})}});a.im._goEasySocket.emit(c)}else n({code:400,content:"TypeError: channel require string or number."})})},e}();t["default"]=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=c(n(3)),i=c(n(1)),s=n(4),a=n(0),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.im=null,this.im=t}return o(e,[{key:"get",value:function(e){var t=this;return new Promise(function(n,o){if(a.calibrator.isStringOrNumber(e)){a.calibrator.isNumber(e)&&(e=e.toString());var c=new r["default"]({name:u.RocketTypes.imGroupOnlineCount,params:{groupId:e},permission:i["default"].READ,singleTimeout:s.SocketTimeout.commonQuerySingle,totalTimeout:s.SocketTimeout.commonQueryTotal,fail:function(e){o(e||{code:408,content:"Failed to query online group users"})},success:function(e){200==e.code?n(e):o(e)}});t.im._goEasySocket.emit(c)}else o({code:400,content:"TypeError: groupId require string or number."})})}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=f(n(3)),i=f(n(1)),s=n(4),a=n(0),u=n(5),c=n(15),l=n(16);function f(e){return e&&e.__esModule?e:{"default":e}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.im=null,this.im=t,t._goEasySocket.addMessageObserver(c.RemoteEvents.groupPresence,this.newMessageReceived.bind(this))}return o(e,[{key:"presence",value:function(e){var t=this;return new Promise(function(n,o){if(Array.isArray(e)&&0!=e.length){for(var r=0;r<e.length;r++){if(!a.calibrator.isStringOrNumber(e[r]))return void o({code:400,content:"TypeError: groupIds item require string or number."});if(a.calibrator.isNumber(e[r])&&(e[r]=e[r].toString()),0==e[r].length)return void o({code:400,content:"TypeError: groupIds has empty item."})}var i={groupIds:e};t.emitRocket(u.RocketTypes.subscribeGroupPresence,i,function(){n({code:200,content:"ok"})},function(e){o({code:e.code||408,content:e.content||"Failed to subscribe group message"})},s.SocketTimeout.commonInfiniteSingle,s.SocketTimeout.commonInfiniteTotal)}else o({code:400,content:"TypeError: groupIds require array."})})}},{key:"unPresence",value:function(e){var t=this;return new Promise(function(n,o){if(a.calibrator.isStringOrNumber(e)){a.calibrator.isNumber(e)&&(e=e.toString());var r={groupId:e};t.emitRocket(u.RocketTypes.unsubscribeGroupPresence,r,function(){n({code:200,content:"ok"})},function(e){o({code:e.code||408,content:e.content||"Failed to unsubscribe presence"})},s.SocketTimeout.commonRequestSingle,s.SocketTimeout.commonRequestTotal)}else o({code:400,content:"TypeError: groupId require string or number."})})}},{key:"emitRocket",value:function(e,t,n,o,s,a){var u=new r["default"]({name:e,params:t,singleTimeout:s,totalTimeout:a,permission:i["default"].WRITE,success:n,fail:o});this.im._goEasySocket.emit(u)}},{key:"newMessageReceived",value:function(e){var t=this,n=null;e.c&&(n=JSON.parse(e.c)),n&&n.events&&n.events.map(function(e){var o=e.userData?JSON.parse(e.userData):{},r={time:e.time,action:e.action,groupOnlineCount:n.userAmount,groupId:n.groupId,id:e.userId,data:o};t.im._event.notify(l.ImApiEvents.GROUP_PRESENCE,r)})}}]),e}();t["default"]=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=f(n(3)),i=f(n(1)),s=n(4),a=n(0),u=n(5),c=n(15),l=n(16);function f(e){return e&&e.__esModule?e:{"default":e}}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.im=null,this.im=t,this.im._goEasySocket.addMessageObserver(c.RemoteEvents.userPresence,this.newMessageReceived.bind(this))}return o(e,[{key:"presence",value:function(e){var t=this;return new Promise(function(n,o){if(Array.isArray(e)&&0!=e.length){for(var r=0;r<e.length;r++){if(!a.calibrator.isStringOrNumber(e[r]))return void o({code:400,content:"TypeError: userIds item require string or number."});if(a.calibrator.isNumber(e[r])&&(e[r]=e[r].toString()),0==e[r].length)return void o({code:400,content:"TypeError: userIds has empty item."})}var i={userIds:e};t.emitRocket(u.RocketTypes.subscribeUserPresence,i,function(){n({code:200,content:"ok"})},function(e){o({code:e.code||408,content:e.content||"Failed to subscribe group message"})},s.SocketTimeout.commonInfiniteSingle,s.SocketTimeout.commonInfiniteTotal)}else o({code:400,content:"TypeError: userIds require array."})})}},{key:"unPresence",value:function(e){var t=this;return new Promise(function(n,o){if(a.calibrator.isStringOrNumber(e)){a.calibrator.isNumber(e)&&(e=e.toString());var r={userId:e};t.emitRocket(u.RocketTypes.unsubscribeUserPresence,r,function(){n({code:200,content:"ok"})},function(e){o({code:e.code||408,content:e.content||"Failed to unsubscribe presence"})},s.SocketTimeout.commonRequestSingle,s.SocketTimeout.commonRequestTotal)}else o({code:400,content:"TypeError: id require string or number."})})}},{key:"emitRocket",value:function(e,t,n,o,s,a){var u=new r["default"]({name:e,params:t,singleTimeout:s,totalTimeout:a,permission:i["default"].WRITE,success:n,fail:o});this.im._goEasySocket.emit(u)}},{key:"newMessageReceived",value:function(e){var t=this,n=[];e.c&&(n=JSON.parse(e.c).events||[]),n.map(function(e){var n=e.userData?JSON.parse(e.userData):{},o={time:e.time,action:e.action,id:e.userId,data:n};t.im._event.notify(l.ImApiEvents.USER_PRESENCE,o)})}}]),e}();t["default"]=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=c(n(3)),i=c(n(1)),s=n(4),a=n(0),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.im=null,this.im=t}return o(e,[{key:"hereNow",value:function(e){var t=this;return new Promise(function(n,o){if(e.userIds&&Array.isArray(e.userIds)&&0!=e.userIds.length){for(var c=0;c<e.userIds.length;c++){if(!a.calibrator.isStringOrNumber(e.userIds[c]))return void o({code:400,content:"TypeError: userIds item require string or number."});if(a.calibrator.isNumber(e.userIds[c])&&(e.userIds[c]=e.userIds[c].toString()),0==e.userIds[c].length)return void o({code:400,content:"TypeError: userIds has empty item."})}var l=new r["default"]({name:u.RocketTypes.imHereNow,params:e,permission:i["default"].READ,singleTimeout:s.SocketTimeout.commonQuerySingle,totalTimeout:s.SocketTimeout.commonQueryTotal,fail:function(e){o({code:e.resultCode||408,content:e.content||"Failed to query online users"})},success:function(e){if(200==e.code){var t=e.content;e.content=t.map(function(e){var t=e.userData?JSON.parse(e.userData):{};return{id:e.userId,data:t}}),n(e)}else o(e)}});t.im._goEasySocket.emit(l)}else o({code:400,content:"TypeError: userIds require array."})})}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=c(n(3)),i=c(n(1)),s=n(4),a=n(7),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.im=null,this.im=t}return o(e,[{key:"hereNow",value:function(e){var t=this;return new Promise(function(n,o){if(a.calibrator.isStringOrNumber(e)){a.calibrator.isNumber(e)&&(e=e.toString());var c=new r["default"]({name:u.RocketTypes.imGroupHereNow,params:{groupId:e},permission:i["default"].READ,singleTimeout:s.SocketTimeout.commonQuerySingle,totalTimeout:s.SocketTimeout.commonQueryTotal,fail:function(e){o({code:e.resultCode||408,content:e.content||"Failed to query online group users"})},success:function(e){if(200==e.code){var t=e.content;e.content=t.map(function(e){var t=e.userData?JSON.parse(e.userData):{};return{id:e.userId,data:t}}),n(e)}else o(e)}});t.im._goEasySocket.emit(c)}else o({code:400,content:"TypeError: groupId require string or number."})})}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.str=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(31);var i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"fileExtension",value:function(e,t){if(r.calibrator.isString(e))try{var n=e.split(t);return n[n.length-1]}catch(o){throw Error(o)}}}]),e}());t.str=i},function(e,t,n){"use strict";t.__esModule=!0;var o=n(20),r=n(10),i=n(57),s=n(33),a=n(15),u=function(){function e(e){this.builder=new s.RemoteAbbrMessageBuilder,this.im=e,e._goEasySocket.addMessageObserver(a.RemoteEvents.imMessage,this.onMessageReceived.bind(this))}return e.prototype.onMessageReceived=function(e){var t=this.builder.build(e);this.sendAck(t),r.GoEasyEventCenter.fire(i.SocketEvents.IM_MESSAGE_RECEIVED,e),r.GoEasyEventCenter.fire(o.IM_INTERNAL_EVENTS.MESSAGE_RECEIVED,t)},e.prototype.sendAck=function(e){this.im._goEasySocket.sendAck("imAck",{publishGuid:e.messageId})},e}();t["default"]=u},function(e,t,n){"use strict";t.__esModule=!0,t.EmitterEventDriver=void 0;var o=n(13),r=function(){function e(){this.emitter=new o}return e.prototype.on=function(e,t){return this.emitter.on(e,t),this},e.prototype.once=function(e,t){return this.emitter.once(e,t),this},e.prototype.off=function(e,t){return this.emitter.off(e,t),this},e.prototype.fire=function(e,t){return this.emitter.emit(e,t),this},e}();t.EmitterEventDriver=r},function(e,t,n){"use strict";t.__esModule=!0;var o=n(3),r=n(1),i=n(4),s=n(2),a=n(5),u=n(6),c=n(7),l=function(){function e(e){this.userData=new Map,this.groupData=new Map,this.userData.set(e.id,e.data)}return e.prototype.putData=function(e,t,n){n||(n={}),e===s.Scene.PRIVATE?this.userData.set(t,n):this.groupData.set(t,n)},e.prototype.loadData=function(e,t){var n=this;return new Promise(function(o,r){var i=n.loadLocalData(e,t);c.calibrator.isUndef(i)?n.loadServerData(e,t).then(function(e){JSON.stringify(e),o(e)})["catch"](function(e){r(e)}):(JSON.stringify(i),o(i))})},e.prototype.loadLocalData=function(e,t){return s.Scene.PRIVATE===t?this.userData.get(e):this.groupData.get(e)},e.prototype.loadServerData=function(e,t){var n=this;return new Promise(function(s,c){var l={targetId:e,type:t},f=new o["default"]({name:a.RocketTypes.imData,params:l,permission:r["default"].READ,singleTimeout:i.SocketTimeout.commonQuerySingle,totalTimeout:i.SocketTimeout.commonQueryTotal,success:function(o){if(200===o.code){var r=JSON.parse(o.content);n.putData(t,e,r),s(r)}else c(o)},fail:function(e){c(e)}});u.im._goEasySocket.emit(f)})},e}();t["default"]=l},function(e,t,n){"use strict";t.__esModule=!0,t.iMMessageBuilder=void 0;var o=n(18),r=n(120),i=n(35),s=n(121),a=n(122),u=n(124),c=n(125),l=n(38),f=n(126),p=n(127),h=n(128),d=n(39),y=n(129),m=n(130),v=n(131),g=n(133),b=n(6),E=n(7),_=n(2),S=n(59),w=n(58),O=new(function(){function e(){var e;this.framework=o.FrameworkDetector.currentFramework(),this.payloadBuilders=((e={})[o.Framework.UNIAPP]={image:new c["default"],file:new l["default"],audio:new f["default"],video:new p["default"],text:new a.TextPayloadBuilder},e[o.Framework.NATIVE_APPLET_WX]={image:new r["default"],file:new i["default"],audio:new s["default"],video:new u["default"],text:new a.TextPayloadBuilder},e[o.Framework.UNKNOWN]={image:new h["default"],file:new d["default"],audio:new y["default"],video:new m["default"],text:new a.TextPayloadBuilder},e)}return e.prototype.buildMessage=function(e,t){var n=this.payloadBuilders[this.framework][e],o=new g.LocalIMMessageBuildOptions(e,t);if(n){var r=n.build(o);o.payload=r}else{r=(new v.CustomPayloadBuilder).build(o);o.payload=r.payload}return this.build(o)},e.prototype.build=function(e){var t,n=e.type,o=e.payload,r=e.createOptions,i=r.to,s=r.notification;return this.validate(s),i.type===_.Scene.GROUP?((t=new S.GroupMessage).groupId=i.id.toString(),t.senderData=b.IM.userData):i.type===_.Scene.PRIVATE&&((t=new w.PrivateMessage).read=!1,t.receiverId=i.id.toString()),t.senderId=b.IM.userId,t.messageId=E.UUID.get(),t.payload=o,t.timestamp=Date.now(),t.type=n,t.recalled=!1,t.status=_.MessageStatus.NEW,t.buildOptions=e,t},e.prototype.validate=function(e){if(E.calibrator.isUndef(b.IM.userId))throw Error("Please call connect() first.");if(e){if(!E.calibrator.isObject(e))throw Error("notification require an object.");if(E.calibrator.isEmpty(e.title))throw Error("notification's title is empty.");if(E.calibrator.isEmpty(e.body))throw Error("notification's body is empty.");if(e.title.length>32)throw Error("notification's title over max length 32");if(e.body.length>50)throw Error("notification's body over max length 50")}},e}());t.iMMessageBuilder=O},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(7),s=n(0),a=n(34),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new a.ImageMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions.file,r=n,a=o.path||o.tempFilePath,u=s.calibrator.isEmpty(o.name)||o.name===undefined?a:o.name;r.name="wx-image."+i.str.fileExtension(u,"."),r.contentType="image/"+i.str.fileExtension(u,"."),r.url=a,r.size=o.size,t.complete=new Promise(function(e,t){wx.getImageInfo({src:r.url,success:function(t){r.width=t.width,r.height=t.height,e()},fail:function(e){t(e)}})})},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(n(35)["default"]);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(36),s=n(0),a=n(7),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new i.AudioMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions.file,r=n,i=o.tempFilePath,u=s.calibrator.isEmpty(o.name)||o.name==undefined?i:o.name,c=o.duration,l=o.fileSize;r.url=i,r.size=l,r.duration=c/1e3,r.name="wx-audio."+a.str.fileExtension(u,"."),r.contentType="audio/"+a.str.fileExtension(u,"."),t.complete=Promise.resolve()},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(n(35)["default"]);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.TextPayloadBuilder=void 0;var i=n(11),s=n(123),a=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new s.TextMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions;n.text=o.text,e.complete=Promise.resolve()},t.prototype.validate=function(e){if(a.calibrator.isEmpty(e.text))throw{code:400,content:"text is empty"};if(!a.calibrator.isString(e.text))throw{code:400,content:"TypeError: text requires string."};if(""===e.text.trim())throw{code:400,content:"text is empty"};if(e.text.length>2500)throw{code:400,content:"Message text over max length 2500"}},t}(i.AbstractPayloadBuilder);t.TextPayloadBuilder=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.TextMessagePayload=void 0;var i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text="",t}return r(t,e),t}(n(25).AbstractMessagePayload);t.TextMessagePayload=i},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(37),s=n(0),a=n(7),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new i.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions.file,o=t,r=o.video,i=o.thumbnail,u=n.duration,c=n.height,l=n.size,f=n.tempFilePath,p=n.thumbTempFilePath,h=n.width,d=n.name,y=void 0===d?"":d,m=s.calibrator.isEmpty(y)?f:y;r.contentType="video/"+a.str.fileExtension(m,"."),r.name="wx-video."+a.str.fileExtension(m,"."),r.url=f,r.width=i.width=h,r.height=i.height=c,r.size=l,r.duration=u,i.url=p,i.contentType="image/jpg",i.name="wx-thumbnail.jpg",e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!s.calibrator.isObject(e))throw Error("it is an empty message.");if(!s.calibrator.isDef(e.file))throw Error("file is empty.")},t}(n(11).AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(7),s=n(0),a=n(34),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new a.ImageMessagePayload},t.prototype.setPayload=function(e,t){var n=t,o=e.createOptions.file;n.url=o.path,n.size=o.size;var r=s.calibrator.isEmpty(o.name)||o.name===undefined?o.path:o.name;n.contentType="image/"+i.str.fileExtension(r,"."),n.name="uni-image."+i.str.fileExtension(r,"."),e.complete=new Promise(function(e,t){uni.getImageInfo({src:o.path,success:function(t){n.width=t.width,n.height=t.height,e()},fail:function(e){t(e)}})})},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(n(38)["default"]);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(0),s=n(7),a=n(36),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new a.AudioMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions,o=t,r=n.file,a=r.tempFilePath,u=i.calibrator.isEmpty(r.name)||r.name==undefined?a:r.name;o.url=a,o.name="uni-audio."+s.str.fileExtension(u,"."),o.contentType="audio/"+s.str.fileExtension(u,"."),e.complete=new Promise(function(e,t){uni.getFileInfo({filePath:a,success:function(r){var s=r.size;if(o.size=s,0===s)e();else if(i.calibrator.isDef(n.file.duration))o.duration=n.file.duration/1e3,e();else{var u=uni.createInnerAudioContext();u.src=a,u.onCanplay(function(n){n.errCode?(u.destroy(),t(n)):(o.duration=u.duration,u.destroy(),e())}),u.onError(function(n){u.destroy(),-99===n.errCode?e():t(n)})}},fail:function(e){t(e)}})})},t.prototype.validate=function(t){e.prototype.validate.call(this,t)},t}(n(38)["default"]);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(0),s=n(7),a=n(37),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new a.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=e.createOptions.file,o=t,r=o.video,a=o.thumbnail,u=n.duration,c=n.height,l=n.size,f=n.tempFilePath,p=n.width,h=n.name,d=void 0===h?"":h,y=i.calibrator.isEmpty(d)?f:d;r.size=l,r.width=p,r.height=c,r.url=f,r.duration=u,r.contentType="video/"+s.str.fileExtension(y,"."),r.name="uni-video."+s.str.fileExtension(y,"."),a.url=f,a.width=p,a.height=c,a.contentType="image/jpg",a.name="uni-thumbnail.jpg",e.complete=Promise.resolve()},t.prototype.validate=function(e){if(!i.calibrator.isObject(e))throw Error("it is an empty message.");if(!i.calibrator.isDef(e.file))throw Error("file is empty.")},t}(n(11).AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(34),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new i.ImageMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions.file,r=n,i=window.URL||window.webkitURL,s=new Image;s.src=i.createObjectURL(o),t.complete=new Promise(function(e,t){s.onload=function(){r.width=s.width,r.height=s.height,i.revokeObjectURL(s.src),e()},s.onerror=function(e){i.revokeObjectURL(s.src),t(e)}})},t.prototype.validate=function(t){e.prototype.validate.call(this,t);var n=["gif","jpg","png","jpeg"];if(!n.find(function(e){return e===t.file.type.split("/")[1].toLowerCase()}))throw Error("Only "+n.join(",")+" is supported image.")},t}(n(39)["default"]);t["default"]=s},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(36),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new i.AudioMessagePayload},t.prototype.setPayload=function(t,n){e.prototype.setPayload.call(this,t,n);var o=t.createOptions.file,r=n,i=window.URL||window.webkitURL,s=document.createElement("audio");s.src=i.createObjectURL(o),t.complete=new Promise(function(e,t){s.onloadedmetadata=function(){r.duration=s.duration,i.revokeObjectURL(s.src),e()},s.onerror=function(e){i.revokeObjectURL(s.src),t(e)}})},t.prototype.validate=function(t){e.prototype.validate.call(this,t);var n=["mp3","ogg","wav","wma","ape","acc","mpeg"];if(!n.find(function(e){return e===t.file.type.split("/")[1].toLowerCase()}))throw Error("Only "+n.join(",")+" is supported audio.")},t}(n(39)["default"]);t["default"]=s},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=n(37),s=n(11),a=n(7),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new i.VideoMessagePayload},t.prototype.setPayload=function(e,t){var n=this,o=e.createOptions.file,r=t,i=r.video,s=r.thumbnail,a=window.URL||window.webkitURL,u=document.createElement("video");u.src=a.createObjectURL(o),i.size=o.size,i.name=o.name,i.contentType=o.type,i.url=u.src,s.name=o.name,s.contentType="image/jpg",e.complete=new Promise(function(e,t){u.onloadedmetadata=function(){i.duration=u.duration,i.width=u.videoWidth,i.height=u.videoHeight,s.width=u.videoWidth,s.height=u.videoHeight,s.url=n.getThumbnailUrl(u),a.revokeObjectURL(u.src),e()},u.onerror=function(e){a.revokeObjectURL(u.src),t(e)}})},t.prototype.getThumbnailUrl=function(e){var t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("image/png")},t.prototype.validate=function(e){if(!a.calibrator.isObject(e))throw Error("it is an empty message.");if(!(e.file instanceof File))throw Error("wrong file type.");if(0==e.file.size)throw Error("File size is 0.");if(e.file.size>31457280)throw Error("message-length limit 30mib");var t=["avi","mov","rmvb","rm","flv","mp4","3gp","quicktime"];if(!t.find(function(t){return t===e.file.type.split("/")[1].toLowerCase()}))throw Error("Only "+t.join(",")+" is supported video.")},t}(s.AbstractPayloadBuilder);t["default"]=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.CustomPayloadBuilder=void 0;var i=n(11),s=n(132),a=n(0),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.create=function(){return new s["default"]},t.prototype.setPayload=function(e,t){var n=e.createOptions;t.payload=n.payload,e.complete=Promise.resolve()},t.prototype.validate=function(e){var t=e.type,n=e.payload;if(a.calibrator.isEmpty(t))throw Error("type is empty.");if(!a.calibrator.isString(t))throw Error("type require a string");if(a.calibrator.isEmpty(n))throw Error("payload is empty.");if(!a.calibrator.isPlainObject(n)&&!a.calibrator.isStringOrNumber(n))throw Error("payload require object | string | number.")},t}(i.AbstractPayloadBuilder);t.CustomPayloadBuilder=u},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0;var i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t}(n(25).AbstractMessagePayload);t["default"]=i},function(e,t,n){"use strict";t.__esModule=!0,t.LocalIMMessageBuildOptions=void 0;var o=function(){return function(e,t){this.type=e,this.createOptions=t}}();t.LocalIMMessageBuildOptions=o},function(e,t,n){"use strict";t.__esModule=!0;var o=n(3),r=n(1),i=n(4),s=n(135),a=n(6),u=n(138),c=n(0),l=n(10),f=n(20),p=n(2),h=n(21),d=n(5),y=function(){function e(){this.payloadImprover=new s.PayloadImprover}return e.prototype.send=function(e){var t=this;this.validate(e);var n=e.message,o=e.accessToken,r=n.buildOptions,i=r.createOptions,s=i.notification,u=i.to;u.data||(u.data={}),a.im._dataCache.putData(u.type,u.id.toString(),u.data),n.status=p.MessageStatus.SENDING;var c=r.complete,l=this.payloadImprover.improve(e);Promise.all([c,l]).then(function(){t.doSend(n,u,s,o,e)})["catch"](function(t){n.status=p.MessageStatus.FAIL,e.onFailed({code:t.code||400,content:t.content||t})})},e.prototype.doSend=function(e,t,n,s,c){var h=new u["default"](e,t,n,s);l.GoEasyEventCenter.fire(f.IM_INTERNAL_EVENTS.MESSAGE_SENDING,e);var y=new o["default"]({name:d.RocketTypes.publishIM,params:h,unique:!0,permission:r["default"].WRITE,singleTimeout:i.SocketTimeout.commonRequestSingle,totalTimeout:i.SocketTimeout.commonRequestTotal,fail:function(t){e.status=p.MessageStatus.FAIL,c.onFailed({code:t.resultCode||408,content:t.content||"Failed to send message."})},success:function(t){200==t.resultCode?(e.status=p.MessageStatus.SUCCESS,e.timestamp=t.content.timestamp,e.clearUseLessAttribute(),l.GoEasyEventCenter.fire(f.IM_INTERNAL_EVENTS.MESSAGE_SEND_SUCCESS,e),c.onSuccess(e)):(e.status=p.MessageStatus.FAIL,c.onFailed(t))}});a.im._goEasySocket.emit(y)},e.prototype.validate=function(e){var t=e.message,n=t.buildOptions.createOptions;if(!(t instanceof h.AbstractMessage))throw new Error("it is invalid message");if(t.status!==p.MessageStatus.NEW)throw new Error("Please create a new message, a message can only be sent once");var o=n.to;if(!o)throw new Error("message require property to.");if(!o.type||o.type!=p.Scene.GROUP&&o.type!=p.Scene.PRIVATE)throw new Error("message require property to.type");if(c.calibrator.isEmpty(o.id))throw new Error("message require property to.id");if(!c.calibrator.isStringOrNumber(o.id))throw new Error("to.id should be a string or number.");if(a.IM.userId===o.id)throw new Error("to.id can not be the same as your id.");if(o.data&&c.calibrator.isFunction(o.data))throw new Error("to.data can not be function");var r=n.notification;if(r)if(c.calibrator.isObject(r)){if(c.calibrator.isEmpty(r.title))throw new Error("notification title is required");if(!c.calibrator.isString(r.title))throw new Error("notification title must be string");if(c.calibrator.isEmpty(r.body))throw new Error("notification body is required");if(!c.calibrator.isString(r.body))throw new Error("notification body must be string")}else if(c.calibrator.isPrimitive(r))throw new Error("notification must be an json object")},e}();t["default"]=y},function(e,t,n){"use strict";t.__esModule=!0,t.PayloadImprover=void 0;var o=n(60),r=n(137),i=n(19),s=function(){function e(){var e;this.improvers=((e={})[i.MessageType.FILE]=new o.FileMessagePayloadImprover,e[i.MessageType.AUDIO]=new o.FileMessagePayloadImprover,e[i.MessageType.IMAGE]=new o.FileMessagePayloadImprover,e[i.MessageType.VIDEO]=new r.VideoMessagePayloadImprover,e)}return e.prototype.improve=function(e){var t=this.improvers[e.message.type];return t?t.improve(e):Promise.resolve()},e}();t.PayloadImprover=s},function(e,t,n){"use strict";t.__esModule=!0,t.AbstractPayloadImprover=void 0;var o=function(){return function(){}}();t.AbstractPayloadImprover=o},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});t.__esModule=!0,t.VideoMessagePayloadImprover=void 0;var i=function(e){function t(){return e.call(this)||this}return r(t,e),t.prototype.setPayload=function(e,t){e.content;var n=t.payload,o="?x-oss-process=video/snapshot,t_0000,f_jpg,w_"+n.video.width+",m_fast,ar_auto";n.video.url=e.content.url,n.thumbnail.url=e.content.url+o,n.video.name=e.content.newFileName},t}(n(60).FileMessagePayloadImprover);t.VideoMessagePayloadImprover=i},function(e,t,n){"use strict";t.__esModule=!0;var o=n(19),r=function(){function e(e,t,n,o){this.validate(e),this.mt=e.type,this.to=t.id.toString(),this.d=JSON.stringify(t.data),this.p=JSON.stringify(e.payload),n&&(this.nt=n),o&&(this.at=o),this.t=t.type,this.guid=e.messageId}return e.prototype.validate=function(e){if(e.type===o.MessageType.TEXT&&JSON.stringify(e.payload).length>3072)throw Error("message-length limit 3kb")},e}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eventCenter=undefined;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=n(16);var s=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subs=null,this.subs=Object.create(null)}return o(e,[{key:"on",value:function(e,t){if(!r.calibrator.isString(e))throw Error("eventType require a string.");if(!r.calibrator.isDef(i.ImApiEvents[e]))throw Error("event not found.");if(!r.calibrator.isFunction(t))throw Error("event require a callback.");this.subs[e]=t}},{key:"notify",value:function(e,t){var n=this.subs[e];n&&n(t)}}]),e}());t.eventCenter=s},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(141),s=n(10),a=n(20),u=n(6),c=n(15),l=n(17),f=n(2),p=n(7),h=n(8),d=n(156),y=n(158),m=n(62),v=n(64),g=function(){function e(){var e=this;this.conversations=new i.Conversations,this.topper=new y["default"](this.conversations),this.remover=new d["default"](this.conversations),u.im._goEasySocket.addMessageObserver(c.RemoteEvents.IM_MSG_READ,this.onRemoteMarkRead.bind(this)),u.im._goEasySocket.addMessageObserver(c.RemoteEvents.IM_MSG_DELETED,this.onRemoteMessageDeleted.bind(this)),u.im._goEasySocket.addMessageObserver(c.RemoteEvents.IM_MSG_RECALLED,this.onRemoteMessageRecalled.bind(this)),u.im._goEasySocket.addDisconnectedObserver(this.onDisconnected.bind(this)),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.MESSAGE_SENDING,function(t){return e.onMessageSending(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.MESSAGE_SEND_SUCCESS,function(t){return e.onMessageSendSuccess(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.MESSAGE_RECEIVED,function(t){return e.onMessageReceived(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_DELETED,function(t){return e.onRemoteMessageDeleted(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_READ,function(t){return e.onRemoteMarkRead(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.UNREAD_MESSAGE_CHANGED,function(){return e.onUnreadMessageChanged()}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,function(t){return e.onMaxMessageChanged(t)}),s.GoEasyEventCenter.on(a.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_RECALLED,function(t){return e.onRemoteMessageRecalled(t)})}return e.prototype.latestConversations=function(){return this.conversations.latestConversations()},e.prototype.history=function(e){var t=this;this.transformOptions(e);var n=l.Target.byIds(e.userId,e.groupId),o=n.scene,r=n.id,i=this.conversations.findOrCreateConversation(o,r),s=i.maxMessageTime();i.history.loadHistory(e).then(function(){s!==i.maxMessageTime()&&(t.conversations.correctPosition(i),i.initialData().then(function(){t.conversations.onUpdated()}))})["catch"](function(e){console.error("Failed to load history:",e)})},e.prototype.topPrivateConversation=function(e){if(this.topper.validateOptions(f.Scene.PRIVATE,e)){var t=l.Target.byScene(f.Scene.PRIVATE,e.userId),n=e.top;this.topper.top(t,n,e)}},e.prototype.topGroupConversation=function(e){if(this.topper.validateOptions(f.Scene.GROUP,e)){var t=l.Target.byScene(f.Scene.GROUP,e.groupId),n=e.top;this.topper.top(t,n,e)}},e.prototype.removePrivateConversation=function(e){if(this.remover.validateOptions(f.Scene.PRIVATE,e)){var t=l.Target.byScene(f.Scene.PRIVATE,e.userId);this.remover.remove(t,e)}},e.prototype.removeGroupConversation=function(e){if(this.remover.validateOptions(f.Scene.GROUP,e)){var t=l.Target.byScene(f.Scene.GROUP,e.groupId);this.remover.remove(t,e)}},e.prototype.onMessageSending=function(e){var t=this,n=l.Target.byIMMessage(e),o=n.scene,r=n.id,i=this.conversations.findOrCreateConversation(o,r);i.history.saveMessage(e),this.conversations.correctPosition(i),i.initialData().then(function(){t.conversations.onUpdated()})},e.prototype.onMessageSendSuccess=function(e){var t=l.Target.byIMMessage(e),n=t.scene,o=t.id,r=this.conversations.findConversation(n,o);r.history.onMessageSendSuccess(e),this.conversations.correctPosition(r),this.conversations.onUpdated()},e.prototype.onMessageReceived=function(e){var t=this,n=l.Target.byIMMessage(e),o=n.scene,r=n.id,i=this.conversations.findOrCreateConversation(o,r);i.history.onMessageReceived(e)&&(this.conversations.correctPosition(i),i.initialData().then(function(){t.conversations.onUpdated()}))},e.prototype.privateMarkAsRead=function(e){var t=l.Target.byScene(f.Scene.PRIVATE,e.userId);this.markAsRead(t,e)},e.prototype.groupMarkAsRead=function(e){var t=l.Target.byScene(f.Scene.GROUP,e.groupId);this.markAsRead(t,e)},e.prototype.markAsRead=function(e,t){return o(this,void 0,void 0,function(){var n;return r(this,function(o){switch(o.label){case 0:return h.CallbackUtils.validateCallbackOptions(t),this.validateTarget(e),n=this.conversations.findConversation(e.scene,e.id),p.calibrator.isDef(n)?[4,n.history.markRead(t)]:[3,2];case 1:return o.sent(),[3,3];case 2:h.CallbackUtils.onFailed(t,{code:400,content:"No unread message that could be marked."}),o.label=3;case 3:return[2]}})})},e.prototype.onRemoteMarkRead=function(e){var t=l.Target.byMessageReadRemoteEvent(e),n=this.conversations.findConversation(t.scene,t.id);p.calibrator.isDef(n)&&n.history.markByRemoteEvent(e)},e.prototype.deleteMessage=function(e){return o(this,void 0,void 0,function(){var t,n,o;return r(this,function(r){switch(r.label){case 0:return m["default"].validate(e),t=e.messages[0],n=l.Target.byIMMessage(t),o=this.conversations.findConversation(n.scene,n.id),p.calibrator.isDef(o)?[4,o.history.deleteMessages(e)]:[3,2];case 1:return r.sent(),[3,3];case 2:throw{code:400,content:"No message that could be deleted"};case 3:return[2]}})})},e.prototype.onRemoteMessageDeleted=function(e){var t=l.Target.byIMMessageDeletedEvent(e),n=this.conversations.findConversation(t.scene,t.id);p.calibrator.isDef(n)&&n.history.syncDeletedMessage(e.deleterId,e.times)},e.prototype.recallMessage=function(e){return o(this,void 0,void 0,function(){var t,n,o;return r(this,function(r){switch(r.label){case 0:return v["default"].validate(e),t=e.messages[0],n=l.Target.byIMMessage(t),o=this.conversations.findConversation(n.scene,n.id),p.calibrator.isDef(o)?[4,o.history.recallMessage(e)]:[3,2];case 1:return r.sent(),[3,3];case 2:throw{code:400,content:"No message that could be recalled"};case 3:return[2]}})})},e.prototype.onRemoteMessageRecalled=function(e){var t=l.Target.byMessageRecalledRemoteEvent(e),n=this.conversations.findConversation(t.scene,t.id);p.calibrator.isDef(n)&&n.history.syncRecalledMessage(e.times)},e.prototype.onDisconnected=function(){this.conversations.expireAllMessageCaches()},e.prototype.transformOptions=function(e){if(h.CallbackUtils.validateCallbackOptions(e),!p.calibrator.isObject(e)||!p.calibrator.isDef(e.userId)&&!p.calibrator.isDef(e.groupId))throw{code:400,content:"userId or groupId is required"};if(p.calibrator.isDef(e.userId)&&p.calibrator.isDef(e.groupId))throw{code:400,content:"only contain userId or groupId"};p.calibrator.isUndef(e.limit)&&(e.limit=10),e.limit>30&&(e.limit=30),p.calibrator.isDef(e.userId)?p.calibrator.isStringOrNumber(e.userId)||h.CallbackUtils.onFailed(e,{code:400,content:"Failed to query history: userId require string or number"}):p.calibrator.isStringOrNumber(e.groupId)||h.CallbackUtils.onFailed(e,{code:400,content:"Failed to query history: groupId require string or number"})},e.prototype.validateTarget=function(e){var t=e.scene===f.Scene.PRIVATE?"userId":"groupId";if(p.calibrator.isUndef(e.id)||p.calibrator.isEmpty(e.id)||!p.calibrator.isStringOrNumber(e.id))throw{code:400,content:t+" requires string or number"}},e.prototype.onUnreadMessageChanged=function(){this.conversations.onUpdated()},e.prototype.onMaxMessageChanged=function(e){var t=this.conversations.findConversation(e.scene,e.id);this.conversations.correctPosition(t),this.conversations.onUpdated()},e}();t["default"]=g},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0,t.Conversations=void 0;var a=n(142),u=n(6),c=n(3),l=n(1),f=n(4),p=n(0),h=n(2),d=n(33),y=n(5),m=n(16),v=n(61),g=function(){function e(){this.list=new Array,this.builder=new d.RemoteAbbrMessageBuilder}return e.prototype.onUpdated=function(){this.loadLocalConversationsAsDtos().then(function(e){u.im._event.notify(m.ImApiEvents.CONVERSATIONS_UPDATED,{unreadTotal:e.content.unreadTotal,conversations:e.content.conversations})})},e.prototype.latestConversations=function(){return this.synchronized?this.loadLocalConversationsAsDtos():this.loadServerConversations()},e.prototype.loadServerConversations=function(){var e=this;return new Promise(function(t,n){var o=new c["default"]({name:y.RocketTypes.imLastConversations,params:{},permission:l["default"].READ,singleTimeout:f.SocketTimeout.commonQuerySingle,totalTimeout:f.SocketTimeout.commonQueryTotal,fail:function(e){n(e)},success:function(o){return i(e,void 0,void 0,function(){var e,r,i,a,c,l,f,p,d,y;return s(this,function(s){if(200===o.code){for(e=o.content,r=0;r<e.length;r++)i=e[r],a=i.t,c=i.top,l=i.d?JSON.parse(i.d):{},f=a===h.Scene.PRIVATE?i.uid:i.g,u.im._dataCache.putData(a,f,l),(p=this.findOrCreateConversation(a,f)).top=c,p.data=l,(d=i.lmsg).t=a,y=this.builder.build(d),p.history.initMaxMessageAndOffsets(y,i.userOffsets),this.correctPosition(p);this.synchronized=!0,this.loadLocalConversationsAsDtos().then(function(e){t(e)})}else n(o);return[2]})})}});u.im._goEasySocket.emit(o)})},e.prototype.loadLocalConversationsAsDtos=function(){var e=this;return new Promise(function(t,n){for(var o=new Array,r=e.list.length,i=0;i<r;i++){var s=e.list[i];if(s.history.messageCache.getMaxMessage()){var a=s.toDto();o.push(a)}}t({code:200,content:{unreadTotal:e.getUnreadTotal(),conversations:o}})})},e.prototype.findOrCreateConversation=function(e,t){var n=this.findConversation(e,t);return p.calibrator.isUndef(n)&&(n=new a.Conversation(e,t),this.insertOne(n)),n},e.prototype.findConversationIndex=function(e,t){return this.list.findIndex(function(n){return e===h.Scene.GROUP&&t===n.targetId||e===h.Scene.PRIVATE&&t===n.targetId})},e.prototype.findConversation=function(e,t){var n=this.findConversationIndex(e,t);return this.list[n]},e.prototype.removeLocalConversation=function(e){var t=e.getTargetId(),n=e.getScene(),o=this.findConversationIndex(n,t);this.list.splice(o,1)},e.prototype.topLocalConversation=function(e,t){e.top=t,this.correctPosition(e),this.onUpdated()},e.prototype.getUnreadTotal=function(){var e=0;return this.list.forEach(function(t){e+=t.history.messageCache.unreadAmount()}),e},e.prototype.insertOne=function(t){e.sortedInserter.insert(this.list,t),this.list.length>e.CONVERSATIONS_MAX_LENGTH&&(this.list=this.list.slice(0,e.CONVERSATIONS_MAX_LENGTH))},e.prototype.correctPosition=function(e){this.removeLocalConversation(e),this.insertOne(e)},e.prototype.expireAllMessageCaches=function(){this.list.forEach(function(e){e.history.expire()})},e.CONVERSATIONS_MAX_LENGTH=200,e.sortedInserter=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.compare=function(e,t){var n;if(e.top==t.top){var o=e.maxMessageTime();n=t.maxMessageTime()-o}else n=e.top?-1:1;return 0===n?0:n>0?1:-1},t}(v.SortedInserter)),e}();t.Conversations=g},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0,t.Conversation=void 0;var i=n(2),s=n(6),a=n(143),u=n(17),c=function(){function e(e,t){this.top=!1,this.data={},this.scene=e,this.targetId=t,this.history=new a["default"](u.Target.byScene(e,t))}return e.prototype.toDto=function(){var e=new i.ConversationDTO;return e.type=this.scene,this.scene===i.Scene.PRIVATE?e.userId=this.targetId:this.scene===i.Scene.GROUP&&(e.groupId=this.targetId),e.lastMessage=this.history.messageCache.getMaxMessage(),e.unread=this.history.messageCache.unreadAmount(),e.top=this.top,e.data=this.data,e},e.prototype.initialData=function(){return o(this,void 0,void 0,function(){var e;return r(this,function(t){switch(t.label){case 0:return e=this,[4,this.getData()];case 1:return e.data=t.sent(),[2]}})})},e.prototype.getData=function(){return s.im._dataCache.loadData(this.targetId,this.scene)},e.prototype.getTargetId=function(){return this.targetId},e.prototype.getScene=function(){return this.scene},e.prototype.maxMessageTime=function(){return this.history.messageCache.maxTime()},e}();t.Conversation=c},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(6),s=n(2),a=n(8),u=n(16),c=n(10),l=n(20),f=n(144),p=n(146),h=n(62),d=n(150),y=n(64),m=function(){function e(e){this.expiredTime=0,this.target=e,this.userOffsetService=new p["default"](e),this.messageCache=new f["default"](e,this.userOffsetService)}return e.prototype.initMaxMessageAndOffsets=function(e,t){if(!this.messageCache.existsMessage(e.messageId)){if(this.userOffsetService.updateUserOffsets(t),this.target.scene===s.Scene.PRIVATE){var n=e;n.read=this.userOffsetService.isRead(n)}this.messageCache.saveMessage(e)}},e.prototype.loadHistory=function(e){return o(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:if(!(this.expiredTime>0)||this.messageCache.isEmpty())return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.updateByServerChange()];case 2:return n.sent(),[3,4];case 3:return t=n.sent(),a.CallbackUtils.onFailed(e,t),[3,4];case 4:return[4,this.messageCache.loadHistory(e)];case 5:return n.sent(),[2]}})})},e.prototype.saveMessage=function(e){this.messageCache.saveMessage(e)},e.prototype.deleteMessages=function(e){return o(this,void 0,void 0,function(){var t,n;return r(this,function(o){switch(o.label){case 0:return t=this.messageCache.getMaxMessage(),n=e.messages,[4,h["default"].deleteServerMessages(n)];case 1:return o.sent(),this.messageCache.deleteMessages(n),a.CallbackUtils.onSuccess(e),n.includes(t)&&c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,this.target),[2]}})})},e.prototype.syncDeletedMessage=function(e,t){if(e===i.IM.userId){var n=this.messageCache.getMaxMessage(),o=this.messageCache.findMessagesByTimes(t);this.messageCache.deleteMessages(o),i.im._event.notify(u.ImApiEvents.MESSAGE_DELETED,o),o.includes(n)&&c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,this.target)}},e.prototype.recallMessage=function(e){return o(this,void 0,void 0,function(){var t,n;return r(this,function(o){switch(o.label){case 0:return t=this.messageCache.getMaxMessage(),n=e.messages,[4,y["default"].recallServerMessages(n)];case 1:return o.sent(),this.messageCache.recallMessages(n),a.CallbackUtils.onSuccess(e),n.includes(t)&&c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,this.target),[2]}})})},e.prototype.syncRecalledMessage=function(e){var t=this.messageCache.getMaxMessage(),n=this.messageCache.findMessagesByTimes(e);n.length>0&&(this.messageCache.recallMessages(n),i.im._event.notify(u.ImApiEvents.MESSAGE_RECALLED,n),this.existsUnreadMessage(n)?c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.UNREAD_MESSAGE_CHANGED):n.includes(t)&&c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,this.target))},e.prototype.existsUnreadMessage=function(e){for(var t=this.userOffsetService.myOffset(),n=0;n<e.length;n++){if(t<e[n].timestamp)return!0}return!1},e.prototype.expire=function(){this.messageCache.isEmpty()||(this.expiredTime=this.messageCache.maxSuccessMessageTime())},e.prototype.updateByServerChange=function(){return o(this,void 0,void 0,function(){var e,t;return r(this,function(n){switch(n.label){case 0:return e=this.target.scene,t=this.target.id,[4,d.ChangeSynchronizer.sync(e,t,this.expiredTime,this.messageCache.minTime())];case 1:return n.sent(),this.expiredTime=0,[2]}})})},e.prototype.markRead=function(e){return o(this,void 0,void 0,function(){var t,n,o;return r(this,function(r){switch(r.label){case 0:if(this.messageCache.isEmpty())return a.CallbackUtils.onSuccess(e),[2];t=this.messageCache.maxSuccessMessageTime(),n=!1,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.userOffsetService.manualMark(t)];case 2:return n=r.sent(),[3,4];case 3:return o=r.sent(),a.CallbackUtils.onFailed(e,o),[2];case 4:return n&&(this.messageCache.markOthersSentRead(t),c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.UNREAD_MESSAGE_CHANGED)),a.CallbackUtils.onSuccess(e),[2]}})})},e.prototype.markByRemoteEvent=function(e){var t=e.time;e.markerId===i.IM.userId?this.synchronizeUnreadAmountByOtherDevices(t):this.markMySentMessagesRead(t)},e.prototype.synchronizeUnreadAmountByOtherDevices=function(e){this.userOffsetService.updateMyOffset(e)&&(this.messageCache.markOthersSentRead(e),c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.UNREAD_MESSAGE_CHANGED))},e.prototype.markMySentMessagesRead=function(e){if(this.target.scene===s.Scene.PRIVATE){this.userOffsetService.updateOffset(this.target.id,e);var t=this.messageCache.markMySentRead(e);t.length>0&&i.im._event.notify(u.ImApiEvents.MESSAGE_READ,t),e===this.messageCache.maxSuccessMessageTime()&&c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.MAX_MESSAGE_CHANGED,this.target)}},e.prototype.onMessageSendSuccess=function(e){if(this.target.scene===s.Scene.PRIVATE){var t=e;t.read||(t.read=this.userOffsetService.isRead(t),t.read&&i.im._event.notify(u.ImApiEvents.MESSAGE_READ,[t]))}this.messageCache.correctPosition(e),this.userOffsetService.updateMyOffset(e.timestamp)},e.prototype.onMessageReceived=function(e){if(!this.messageCache.existsMessage(e.messageId)){this.saveMessage(e);var t=e.timestamp;if(e.senderId==i.IM.userId)this.userOffsetService.updateMyOffset(t)&&this.messageCache.markOthersSentRead(t);else if(this.target.scene===s.Scene.PRIVATE){this.userOffsetService.updateOffset(this.target.id,t);var n=this.messageCache.markMySentRead(t);n.length>0&&i.im._event.notify(u.ImApiEvents.MESSAGE_READ,n)}var o=this.target.scene;return o===s.Scene.PRIVATE?i.im._event.notify(u.ImApiEvents.PRIVATE_MESSAGE_RECEIVED,e):o===s.Scene.GROUP&&i.im._event.notify(u.ImApiEvents.GROUP_MESSAGE_RECEIVED,e),!0}return!1},e}();t["default"]=m},function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},a=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};t.__esModule=!0;var u=n(3),c=n(1),l=n(4),f=n(6),p=n(2),h=n(33),d=n(145),y=n(5),m=n(8),v=n(7),g=n(61),b=function(){function e(e,t){this.builder=new h.RemoteAbbrMessageBuilder,this.messages=new Array,this.allLoaded=!1,this.target=e,this.userOffsetService=t}return e.prototype.sliceOverlengthMessages=function(){this.messages.length>e.CACHE_MAX_LENGTH&&(this.messages=this.messages.slice(-e.CACHE_MAX_LENGTH),!0===this.allLoaded&&(this.allLoaded=!1))},e.prototype.unreadAmount=function(){var e,t,n=0,o=this.userOffsetService.myOffset();try{for(var r=a(this.messages),i=r.next();!i.done;i=r.next()){var s=i.value;s.senderId!==f.IM.userId&&s.timestamp>o&&!s.recalled&&(n+=1)}}catch(u){e={error:u}}finally{try{i&&!i.done&&(t=r["return"])&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.maxTime=function(){var e=this.getMaxMessage();return v.calibrator.isDef(e)?e.timestamp:0},e.prototype.getMaxMessage=function(){return this.messages[this.messages.length-1]},e.prototype.loadHistory=function(e){return i(this,void 0,void 0,function(){var t,n,o,r,i,a,u,c;return s(this,function(s){switch(s.label){case 0:if(t=e.limit,n=e.lastTimestamp,o=this.loadLocalMessages(t,n),!1!==this.allLoaded||o.length===t)return[3,4];r=t-o.length,i=o[0]?o[0].timestamp:n,a={userId:e.userId,groupId:e.groupId,lastTimestamp:i,limit:r},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.loadServerMessages(a)];case 2:return u=s.sent(),o=u.concat(o),[3,4];case 3:return c=s.sent(),m.CallbackUtils.onFailed(e,c),[3,4];case 4:return m.CallbackUtils.onSuccess(e,{code:200,content:o}),[2]}})})},e.prototype.loadLocalMessages=function(e,t){var n=[],o=this.messages.length;if(t){if(o>0){var r=this.messages[0].timestamp,i=this.messages[o-1].timestamp;if(t>=r&&t<=i)for(var s=o-1;s>=0;s--){var a=this.messages[s];if(a.timestamp<t){if(!(n.length<e))break;n.unshift(a)}}}}else n=this.messages.slice(-e);return n},e.prototype.loadServerMessages=function(t){var n=this,o=new d["default"](t);return new Promise(function(r,i){var s=new u["default"]({name:y.RocketTypes.IM_HISTORY,params:o,permission:c["default"].READ,singleTimeout:l.SocketTimeout.commonQuerySingle,totalTimeout:l.SocketTimeout.commonQueryTotal,fail:function(e){i({code:e.code||408,content:e.content||"Failed to query message"})},success:function(o){if(200===o.code){var s=o.content,a=s.messages;n.userOffsetService.updateUserOffsets(s.userOffsets);var u=n.convertServerMessages(a);n.messages.length<e.CACHE_MAX_LENGTH&&(n.cacheServerMessages(t,u),a.length<t.limit&&(n.allLoaded=!0)),r(u)}else i(o)}});f.im._goEasySocket.emit(s)})},e.prototype.cacheServerMessages=function(e,t){var n=this.messages[0],o=this.messages.length;(!e.lastTimestamp||o>0&&n.timestamp===e.lastTimestamp)&&(this.messages=t.concat(this.messages))},e.prototype.findMessageByTime=function(e){return this.messages.find(function(t){return e===t.timestamp})},e.prototype.findMessagesByTimes=function(e){var t=this,n=[];return e.forEach(function(e){var o=t.findMessageByTime(e);v.calibrator.isDef(o)&&n.push(o)}),n},e.prototype.existsMessage=function(e){return this.findMessageIndexById(e)>-1},e.prototype.findMessageIndexById=function(e){return this.messages.findIndex(function(t){return e===t.messageId})},e.prototype.deleteMessage=function(e){var t=this.findMessageIndexById(e);t>=0&&this.messages.splice(t,1)},e.prototype.recallMessages=function(e){var t=this;e.forEach(function(e){var n=t.findMessageByTime(e.timestamp);v.calibrator.isDef(n)&&(n.recalled=!0),e.recalled=!0})},e.prototype.isEmpty=function(){return 0===this.messages.length},e.prototype.deleteMessages=function(e){var t=this;e.forEach(function(e){t.deleteMessage(e.messageId)})},e.prototype.convertServerMessages=function(e){var t=this,n=[];return e.forEach(function(e){t.target.scene===p.Scene.PRIVATE?(e.t=p.Scene.PRIVATE,e.r=e.s===f.IM.userId?t.target.id:f.IM.userId):(e.t=p.Scene.GROUP,e.r=t.target.id);var o=t.builder.build(e);if(!t.existsMessage(o.messageId)){if(o.scene()===p.Scene.PRIVATE){var r=o;r.read=t.userOffsetService.isRead(r)}n.push(o)}}),n},e.prototype.markOthersSentRead=function(e){if(this.target.scene===p.Scene.PRIVATE)for(var t=this.messages.length-1;t>=0;t--){var n=this.messages[t];if(n.senderId!==f.IM.userId&&n.timestamp<=e){if(n.read)break;n.read=!0}}},e.prototype.markMySentRead=function(e){for(var t=new Array,n=this.messages.length-1;n>=0;n--){var o=this.messages[n],r=o;if(r.senderId===f.IM.userId&&o.timestamp<=e&&o.status===p.MessageStatus.SUCCESS){if(r.read)break;r.read=!0,t.push(r)}}return t},e.prototype.saveMessage=function(t){e.sortedInserter.insert(this.messages,t),this.sliceOverlengthMessages()},e.prototype.maxSuccessMessageTime=function(){for(var e=this.messages.length-1;e>=0;e--)if(this.messages[e].status===p.MessageStatus.SUCCESS)return this.messages[e].timestamp;return 0},e.prototype.minTime=function(){return this.isEmpty()?0:this.messages[0].timestamp},e.prototype.correctPosition=function(e){this.deleteMessage(e.messageId),this.saveMessage(e)},e.CACHE_MAX_LENGTH=200,e.sortedInserter=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.compare=function(e,t){var n=e.timestamp-t.timestamp;return n>0?1:0===n?0:-1},t}(g.SortedInserter)),e}();t["default"]=b},function(e,t,n){"use strict";t.__esModule=!0;var o=n(2),r=n(7),i=function(){return function(e){r.calibrator.isDef(e.userId)?(this.scene=o.Scene.PRIVATE,this.id=e.userId):(this.scene=o.Scene.GROUP,this.id=e.groupId),this.id=this.id.toString(),this.lastTimestamp=e.lastTimestamp,this.limit=e.limit}}();t["default"]=i},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(6),s=n(3),a=n(1),u=n(4),c=n(2),l=n(147),f=n(5),p=n(148),h=function(){function e(e){this.userOffsets=new p.UserOffsets,this.target=e}return e.prototype.isRead=function(e){var t=e.timestamp;return e.senderId===i.IM.userId?this.userOffsets.getOffset(e.receiverId)>=t:this.userOffsets.myOffset()>=t},e.prototype.manualMark=function(e){return o(this,void 0,void 0,function(){var t;return r(this,function(n){switch(n.label){case 0:return this.userOffsets.markingTime=e,t=this.userOffsets.myOffset(),e>t?[4,this.updateServerOffsets(e)]:[3,2];case 1:if(n.sent(),e===this.userOffsets.markingTime)return this.userOffsets.updateMyOffset(e),[2,!0];n.label=2;case 2:return[2,!1]}})})},e.prototype.updateMyOffset=function(e){return this.userOffsets.updateMyOffset(e)},e.prototype.updateOffset=function(e,t){this.userOffsets.updateOffset(e,t)},e.prototype.updateServerOffsets=function(e){return o(this,void 0,void 0,function(){var t,n;return r(this,function(o){return(t=new l.ReadMessageMarkRequest).lastTimestamp=e,t.lastConsumedTimestamp=this.userOffsets.myOffset(),n=f.RocketTypes.markGroupMessageAsRead,this.target.scene===c.Scene.PRIVATE?(t.friendId=this.target.id,n=f.RocketTypes.markPrivateMessageAsRead):t.groupId=this.target.id,[2,new Promise(function(e,o){var r=new s["default"]({name:n,params:t,permission:a["default"].WRITE,singleTimeout:u.SocketTimeout.commonRequestSingle,totalTimeout:u.SocketTimeout.commonRequestTotal,success:function(t){200===t.code?e(t):o(t)},fail:function(e){o(e)}});i.im._goEasySocket.emit(r)})]})})},e.prototype.updateUserOffsets=function(e){this.userOffsets.updateUserOffsets(e)},e.prototype.myOffset=function(){return this.userOffsets.myOffset()},e}();t["default"]=h},function(e,t,n){"use strict";t.__esModule=!0,t.ReadMessageMarkRequest=void 0;var o=function(){return function(){}}();t.ReadMessageMarkRequest=o},function(e,t,n){"use strict";t.__esModule=!0,t.UserOffsets=void 0;var o=n(7),r=n(6),i=function(){function e(){this.offsetMap=new Map,this.markingTime=0}return e.prototype.updateOffset=function(e,t){var n=this.offsetMap.get(e);return o.calibrator.isDef(n)?t>n&&(this.offsetMap.set(e,t),!0):(this.offsetMap.set(e,t),!0)},e.prototype.updateUserOffsets=function(e){var t=this;e.forEach(function(e){var n=e.userId,o=e.offset;t.updateOffset(n,o)})},e.prototype.updateMyOffset=function(e){return this.updateOffset(r.IM.userId,e)},e.prototype.myOffset=function(){return this.getOffset(r.IM.userId)},e.prototype.getOffset=function(e){var t=this.offsetMap.get(e);return t||0},e}();t.UserOffsets=i},function(e,t,n){"use strict";t.__esModule=!0,t.DeleteMessageRequest=void 0;var o=n(2),r=n(17),i=function(){return function(e){var t=this;this.times=new Array;var n=e[0],i=r.Target.byIMMessage(n);this.scene=i.scene,this.targetId=i.id,e.forEach(function(e){e.status===o.MessageStatus.SUCCESS&&t.times.push(e.timestamp)}),this.times.sort(function(e,t){return e<t?-1:e==t?0:1})}}();t.DeleteMessageRequest=i},function(e,t,n){"use strict";t.__esModule=!0,t.ChangeSynchronizer=void 0;var o=n(151),r=n(3),i=n(5),s=n(1),a=n(4),u=n(152),c=n(10),l=n(20),f=n(153),p=n(6),h=n(154),d=n(63),y=function(){function e(){}return e.sync=function(e,t,n,y){var m=new o["default"](e,t,n,y);return new Promise(function(n,o){var y=new r["default"]({name:i.RocketTypes.IM_HISTORY_CHANGE,params:m,permission:s["default"].READ,singleTimeout:a.SocketTimeout.commonQuerySingle,totalTimeout:a.SocketTimeout.commonQueryTotal,fail:function(e){o(e)},success:function(r){if(200===r.code){var i=r.content;i.userOffsets.forEach(function(n){var o=n.userId,r=n.offset,i=new u.ReadMessageMarkedRemoteEvent(e,o,t,r);c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_READ,i)});var s=i.deletedMessageTimes;if(s.length>0){var a=new f.MessageDeletedRemoteEvent(e,p.IM.userId,t,s);c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_DELETED,a)}if(i.recalled.length>0){var y=d["default"].conversationId(e,p.IM.userId,t),m=new h.MessageRecalledRemoteEvent(e,y,i.recalled);c.GoEasyEventCenter.fire(l.IM_INTERNAL_EVENTS.REMOTE_MESSAGE_RECALLED,m)}n(r)}else o(r)}});p.im._goEasySocket.emit(y)})},e}();t.ChangeSynchronizer=y},function(e,t,n){"use strict";t.__esModule=!0;var o=function(){return function(e,t,n,o){this.scene=e,this.id=t,this.after=n,this.min=o}}();t["default"]=o},function(e,t,n){"use strict";t.__esModule=!0,t.ReadMessageMarkedRemoteEvent=void 0;var o=function(){return function(e,t,n,o){this.scene=e,this.markerId=t,this.targetId=n,this.time=o}}();t.ReadMessageMarkedRemoteEvent=o},function(e,t,n){"use strict";t.__esModule=!0,t.MessageDeletedRemoteEvent=void 0;var o=function(){return function(e,t,n,o){this.scene=e,this.deleterId=t,this.targetId=n,this.times=o}}();t.MessageDeletedRemoteEvent=o},function(e,t,n){"use strict";t.__esModule=!0,t.MessageRecalledRemoteEvent=void 0;var o=function(){return function(e,t,n){this.scene=e,this.conversationId=t,this.times=n}}();t.MessageRecalledRemoteEvent=o},function(e,t,n){"use strict";t.__esModule=!0,t.RecallMessageRequest=void 0;var o=n(17),r=function(){return function(e){var t=this;this.times=new Array;var n=e[0],r=o.Target.byIMMessage(n);this.scene=r.scene,this.targetId=r.id,e.forEach(function(e){t.times.push(e.timestamp)}),this.times.sort(function(e,t){return e<t?-1:e==t?0:1})}}();t.RecallMessageRequest=r},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(2),s=n(8),a=n(7),u=n(5),c=n(3),l=n(1),f=n(4),p=n(6),h=n(157),d=function(){function e(e){this.conversations=e}return e.prototype.remove=function(e,t){return o(this,void 0,void 0,function(){var n;return r(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.removeServerConversation(e.scene,e.id)];case 1:return o.sent(),this.removeLocalConversation(e),s.CallbackUtils.onSuccess(t),[3,3];case 2:return n=o.sent(),s.CallbackUtils.onFailed(t,n),[3,3];case 3:return[2]}})})},e.prototype.removeLocalConversation=function(e){var t=e.scene,n=e.id,o=this.conversations.findConversation(t,n);a.calibrator.isDef(o)&&(this.conversations.removeLocalConversation(o),this.conversations.onUpdated())},e.prototype.removeServerConversation=function(e,t){var n=new h["default"](e,t);return new Promise(function(e,t){var o=new c["default"]({name:u.RocketTypes.removeConversation,params:n,permission:l["default"].WRITE,singleTimeout:f.SocketTimeout.commonRequestSingle,totalTimeout:f.SocketTimeout.commonRequestTotal,success:function(n){200==n.code?e(n):t(n)},fail:function(e){t(e)}});p.im._goEasySocket.emit(o)})},e.prototype.validateOptions=function(e,t){if(a.calibrator.isUndef(t))throw{code:400,content:"Failed to remove conversation: bad parameters"};if(!a.calibrator.isObject(t))return s.CallbackUtils.onFailed(t,{code:400,content:"Failed to remove conversation: bad parameters"}),!1;var n,o;e===i.Scene.PRIVATE?(n=t.userId,o="Failed to remove conversation: userId requires string or number"):(n=t.groupId,o="Failed to remove conversation: groupId requires string or number");if(a.calibrator.isUndef(n)||a.calibrator.isEmpty(n)||!a.calibrator.isStringOrNumber(n))return s.CallbackUtils.onFailed(t,{code:400,content:o}),!1;var r=this.conversations.findConversation(e,n.toString());return!a.calibrator.isUndef(r)||(s.CallbackUtils.onFailed(t,{code:400,content:"Failed to remove conversation: conversation doesn not exists"}),!1)},e}();t["default"]=d},function(e,t,n){"use strict";t.__esModule=!0;var o=function(){return function(e,t){this.type=e,this.targetId=t}}();t["default"]=o},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function s(e){try{u(o.next(e))}catch(t){i(t)}}function a(e){try{u(o["throw"](e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}u((o=o.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),"throw":a(1),"return":a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=2&i[0]?o["return"]:i[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};t.__esModule=!0;var i=n(2),s=n(8),a=n(7),u=n(5),c=n(3),l=n(1),f=n(4),p=n(6),h=n(159),d=function(){function e(e){this.conversations=e}return e.prototype.top=function(e,t,n){return o(this,void 0,void 0,function(){var o;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.topServerConversation(e,t)];case 1:return r.sent(),this.topLocalConversation(e,t),s.CallbackUtils.onSuccess(n),[3,3];case 2:return o=r.sent(),s.CallbackUtils.onFailed(n,o),[3,3];case 3:return[2]}})})},e.prototype.topLocalConversation=function(e,t){var n=e.scene,o=e.id,r=this.conversations.findConversation(n,o);a.calibrator.isDef(r)&&this.conversations.topLocalConversation(r,t)},e.prototype.topServerConversation=function(e,t){var n=new h["default"](e.scene,t,e.id);return new Promise(function(e,t){var o=new c["default"]({name:u.RocketTypes.topConversation,params:n,permission:l["default"].WRITE,singleTimeout:f.SocketTimeout.commonRequestSingle,totalTimeout:f.SocketTimeout.commonRequestTotal,success:function(n){200===n.code?e(n):t(n)},fail:function(e){t(e)}});p.im._goEasySocket.emit(o)})},e.prototype.validateOptions=function(e,t){if(a.calibrator.isUndef(t))throw{code:400,content:"Failed to top conversation: bad parameters"};if(!a.calibrator.isObject(t))return s.CallbackUtils.onFailed(t,{code:400,content:"Failed to top conversation: bad parameters"}),!1;var n,o,r,u;e===i.Scene.PRIVATE?(n=(u=t).top,o=u.userId,r="Failed to top conversation: userId requires string or number"):(n=(u=t).top,o=u.groupId,r="Failed to top conversation: groupId requires string or number");if(a.calibrator.isUndef(o)||a.calibrator.isEmpty(o)||!a.calibrator.isStringOrNumber(o))return s.CallbackUtils.onFailed(t,{code:400,content:r}),!1;if(!a.calibrator.isBoolean(n))return s.CallbackUtils.onFailed(t,{code:400,content:"Failed to top conversation: top requires boolean"}),!1;var c=this.conversations.findConversation(e,o.toString());return a.calibrator.isUndef(c)?(s.CallbackUtils.onFailed(t,{code:400,content:"Failed to top conversation: conversation does not exists"}),!1):c.top!==n||(s.CallbackUtils.onFailed(t,{code:400,content:"Failed to top conversation: no change"}),!1)},e}();t["default"]=d},function(e,t,n){"use strict";t.__esModule=!0;var o=function(){return function(e,t,n){this.type=e,this.top=t,this.targetId=n}}();t["default"]=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=c(n(3)),s=c(n(1)),a=n(4),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pubSub=null,this.pubSub=t}return o(e,[{key:"get",value:function(e,t){if(r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop),r.calibrator.isDef(e.channel)){r.calibrator.isNumber(e.channel)&&(e.channel=e.channel.toString());var n=new i["default"]({name:u.RocketTypes.historyMessages,permission:s["default"].READ,params:e,singleTimeout:a.SocketTimeout.commonQuerySingle,totalTimeout:a.SocketTimeout.commonQueryTotal,success:function(t){e.onSuccess({code:t.resultCode||t.code||200,content:t.content})},fail:function(t){e.onFailed({code:t.resultCode||t.code,content:t.content})}});this.pubSub.goEasySocket.emit(n)}else e.onFailed(res)}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=c(n(3)),s=c(n(1)),a=n(4),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pubSub=null,this.pubSub=t}return o(e,[{key:"byChannel",value:function(e){var t={channels:[],includeUsers:!1,distinct:!1};if(r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop),Array.isArray(e.channels))for(var n=0;n<e.channels.length;n++){var o=e.channels[n];r.calibrator.isNumber(o)&&(o=o.toString()),t.channels.push(o)}if(0!==t.channels.length){1==e.includeUsers&&(t.includeUsers=!0),1==e.distinct&&(t.distinct=!0);var c=new i["default"]({name:u.RocketTypes.hereNow,permission:s["default"].READ,params:t,singleTimeout:a.SocketTimeout.commonQuerySingle,totalTimeout:a.SocketTimeout.commonQueryTotal,success:function(t){var n=t.content,o=n.channels;for(var r in o)if(o.hasOwnProperty(r)){var i=o[r];i.users&&(i.users=i.users.map(function(e){return e.data=e.data?JSON.parse(e.data):{},e}))}e.onSuccess({code:t.resultCode||t.code||200,content:n})},fail:function(t){e.onFailed({code:t.resultCode||t.code||200,content:t.content})}});this.pubSub.goEasySocket.emit(c)}else e.onFailed({code:408,content:"channels is required."})}},{key:"byUserId",value:function(e){var t={userIds:[],distinct:!0};if(r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop),r.calibrator.isDef(e.userIds)&&(t.userIds=e.userIds.map(function(e){return e.toString()})),0==e.distinct&&(t.distinct=!1),0===t.userIds.length)e.onFailed({code:400,content:"userIds is required"});else if(t.userIds.length>500)e.onFailed({code:400,content:"userIds is over max length 500"});else{var n=new i["default"]({name:u.RocketTypes.hereNowByUserIds,permission:s["default"].READ,params:t,singleTimeout:a.SocketTimeout.commonQuerySingle,totalTimeout:a.SocketTimeout.commonQueryTotal,success:function(t){var n=t.content;n=n.map(function(e){var t={};return t.id=e.userId,t.data=e.userData?JSON.parse(e.userData):{},t}),e.onSuccess({code:t.resultCode||t.code||200,content:n})},fail:function(t){e.onFailed({code:t.resultCode||t.code||200,content:t.content})}});this.pubSub.goEasySocket.emit(n)}}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=c(n(3)),s=c(n(1)),a=n(4),u=n(5);function c(e){return e&&e.__esModule?e:{"default":e}}var l=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pubSub=null,this.pubSub=t}return o(e,[{key:"publish",value:function(e){if(r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop),r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isEmpty(e.channel))throw{code:400,content:"channel is required."};if(r.calibrator.isNumber(e.channel)&&(e.channel=e.channel.toString()),r.calibrator.isEmpty(e.message))throw{code:400,content:"message is required."};if(r.calibrator.isNumber(e.message)&&(e.message=e.message.toString()),!r.calibrator.isString(e.message))throw{code:400,content:"TypeError: message requires string."};if(e.message.length>2500)throw{code:400,content:"Message over max length 2500."};if(r.calibrator.isObject(e.notification)){if(r.calibrator.isEmpty(e.notification.title))throw{code:400,content:"notification.title is required."};if(!r.calibrator.isString(e.notification.title))throw{code:400,content:"TypeError: notification.title requires string."};if(e.notification.title.length>32)throw{code:400,content:"TypeError: notification.title over max length 32."};if(r.calibrator.isEmpty(e.notification.body))throw{code:400,content:"notification.body is required."};if(!r.calibrator.isString(e.notification.body))throw{code:400,content:"TypeError: notification.body must be string."};if(e.notification.body.length>50)throw{code:400,content:"notification.body over max length 50."}}else if(r.calibrator.isPrimitive(e.notification))throw{code:400,content:"TypeError: notification requires an object."};var t={channel:e.channel,content:e.message,nt:e.notification,at:e.accessToken,guid:r.UUID.get()},n=new i["default"]({name:u.RocketTypes.publish,params:t,unique:!0,singleTimeout:a.SocketTimeout.commonRequestSingle,totalTimeout:a.SocketTimeout.commonRequestTotal,permission:s["default"].WRITE,success:function(t){e.onSuccess({code:200,content:"ok"})},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});this.pubSub.goEasySocket.emit(n)}}]),e}();t["default"]=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=d(n(3)),s=d(n(1)),a=d(n(164)),u=n(4),c=d(n(12)),l=n(10),f=n(65),p=n(5),h=n(15);function d(e){return e&&e.__esModule?e:{"default":e}}var y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.subscriptions=[],this.pubSub=null,this.pubSub=t}return o(e,[{key:"initialGoEasySocket",value:function(){var e=this.pubSub.goEasySocket;e.addMessageObserver(h.RemoteEvents.message,this.onNewMessage.bind(this)),e.addExpiredReconnectedObserver(this.onExpiredReconnected.bind(this)),e.addConnectedObserver(this.onReconnected.bind(this))}},{key:"resubscribe",value:function(){var e=this.subscriptions.slice(0);this.subscriptions=[];for(var t=0;t<e.length;t++)0!=e[t].channels.length&&this.subscribe(e[t])}},{key:"onExpiredReconnected",value:function(){this.resubscribe()}},{key:"onReconnected",value:function(){this.pubSub.neverConnect||this.pubSub.goEasySocket.status==c["default"].RECONNECTED||this.resubscribe()}},{key:"onNewMessage",value:function(e){if(!(e.n.indexOf("_presence")>-1)){e.a&&this.pubSub.goEasySocket.sendAck("ack",{publishGuid:e.i});var t={time:e.t,channel:e.n,content:e.c};l.GoEasyEventCenter.fire(f.PUBSUB_INTERNAL_EVENTS.MESSAGE_RECEIVED,e),this.findSubscriptionByChannel(t.channel).onMessage(t)}}},{key:"formatOptions",value:function(e){var t=!r.calibrator.isEmpty(e.channel),n=!r.calibrator.isEmpty(e.channels);if(this.formatCallback(e),r.calibrator.isFunction(e.onMessage)||(e.onMessage=r.noop),!t&&!n)return e.onFailed({code:400,content:"channel is required"}),!1;if(!t||!n){if(t&&(r.calibrator.isNumber(e.channel)&&(e.channel=e.channel.toString()),e.channels=[e.channel]),n){if(!Array.isArray(e.channels)||0==e.channels.length)return void e.onFailed({code:400,content:"channels must be an array"});if(e.channels.length>500)return e.onFailed({code:400,content:"channels over max length:500"}),!1;for(var o=0,i=e.channels.length;o<i;o++)if(r.calibrator.isNumber(e.channels[o])&&(e.channels[o]=e.channels[o].toString()),r.calibrator.isEmpty(e.channels[o]))return e.onFailed({code:400,content:"Channels array contains empty channel"}),!1}return!0}e.onFailed({code:400,content:"subscribe to either channel or channels, not both"})}},{key:"formatCallback",value:function(e){r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop)}},{key:"subscribe",value:function(e){var t=this;if(this.formatOptions(e)){var n=new i["default"]({name:p.RocketTypes.subscribe,permission:s["default"].READ,singleTimeout:u.SocketTimeout.commonInfiniteSingle,totalTimeout:u.SocketTimeout.commonInfiniteTotal,params:{channels:e.channels,accessToken:e.accessToken},success:function(){var n=new a["default"]({channels:e.channels,accessToken:e.accessToken,onSuccess:e.onSuccess,onFailed:e.onFailed,onMessage:e.onMessage});t.subscriptions.push(n),e.onSuccess({code:200,content:"ok"})},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});this.pubSub.goEasySocket.emit(n)}}},{key:"unsubscribe",value:function(e){var t=this;if(this.formatCallback(e),r.calibrator.isDef(e.channel))if(r.calibrator.isNumber(e.channel)&&(e.channel=e.channel.toString()),this.findSubscriptionByChannel(e.channel)){var n=new i["default"]({name:p.RocketTypes.unsubscribe,params:{channel:e.channel},permission:s["default"].READ,singleTimeout:u.SocketTimeout.commonRequestSingle,totalTimeout:u.SocketTimeout.commonRequestTotal,success:function(){e.onSuccess({code:200,content:"ok"}),t.removeChannel(e.channel)},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});this.pubSub.goEasySocket.emit(n)}else e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"});else e.onFailed({code:400,content:"channel is required"})}},{key:"removeChannel",value:function(e){for(var t=0;t<this.subscriptions.length;t++)for(var n=this.subscriptions[t].channels,o=0;o<n.length;o++)if(n[o]==e){this.subscriptions[t].channels.splice(o,1);break}}},{key:"findSubscriptionByChannel",value:function(e){for(var t=!1,n=null,o=this.subscriptions.length-1;o>=0;o--){for(var r=this.subscriptions[o].channels,i=0;i<r.length;i++)if(r[i]==e){t=!0,n=this.subscriptions[o];break}if(t)break}return n}}]),e}();t["default"]=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.channels=[],this.accessToken=null,this.onSuccess=null,this.onFailed=null,this.onMessage=null,this.channels=t.channels,this.accessToken=t.accessToken,this.onSuccess=t.onSuccess,this.onFailed=t.onFailed,this.onMessage=t.onMessage}return o(e,[{key:"empty",value:function(){}}]),e}();t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(0),i=p(n(3)),s=p(n(1)),a=n(4),u=p(n(166)),c=p(n(12)),l=n(5),f=n(15);function p(e){return e&&e.__esModule?e:{"default":e}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.presenters=[],this.pubSub=null,this.pubSub=t}return o(e,[{key:"initialGoEasySocket",value:function(){var e=this.pubSub.goEasySocket;e.addMessageObserver(f.RemoteEvents.message,this.onNewMessage.bind(this)),e.addExpiredReconnectedObserver(this.onExpiredReconnected.bind(this)),e.addConnectedObserver(this.onReconnected.bind(this))}},{key:"resubscribe",value:function(){var e=this.presenters.slice(0);this.presenters=[];for(var t=0;t<e.length;t++){for(var n=0;n<e[t].channels.length;n++){var o=e[t].channels[n].split("_presence");e[t].channels[n]=o[0]}0!=e[t].channels.length&&this.subscribePresence(e[t])}}},{key:"onExpiredReconnected",value:function(){this.resubscribe()}},{key:"onReconnected",value:function(){this.pubSub.neverConnect||this.pubSub.goEasySocket.status==c["default"].RECONNECTED||this.resubscribe()}},{key:"onNewMessage",value:function(e){if(-1!=e.n.indexOf("_presence")){var t=this.findPresenceByChannel(e.n);if(t){var n=JSON.parse(e.c);n.events=n.events.map(function(e){var t=e.userData?JSON.parse(e.userData):{};return{time:e.time,action:e.action,id:e.userId,data:t}}),t.onPresence(n)}}}},{key:"formatOptions",value:function(e){var t=!r.calibrator.isEmpty(e.channel),n=!r.calibrator.isEmpty(e.channels);if(this.formatCallback(e),r.calibrator.isFunction(e.onPresence)||(e.onPresence=r.noop),!t&&!n)return e.onFailed({code:400,content:"channel is required"}),!1;if(!t||!n){if(t&&(r.calibrator.isNumber(e.channel)&&(e.channel=e.channel.toString()),e.channels=[e.channel]),n){if(!Array.isArray(e.channels)||0==e.channels.length)return void e.onFailed({code:400,content:"channels must be an array"});if(e.channels.length>500)return e.onFailed({code:400,content:"channels over max length:500"}),!1;for(var o=0,i=e.channels.length;o<i;o++)if(r.calibrator.isNumber(e.channels[o])&&(e.channels[o]=e.channels[o].toString()),r.calibrator.isEmpty(e.channels[o]))return e.onFailed({code:400,content:"Channels array contains empty channel"}),!1}return!0}e.onFailed({code:400,content:"subscribe to either channel or channels, not both"})}},{key:"formatCallback",value:function(e){r.calibrator.isFunction(e.onSuccess)||(e.onSuccess=r.noop),r.calibrator.isFunction(e.onFailed)||(e.onFailed=r.noop)}},{key:"subscribePresence",value:function(e){var t=this;if(this.formatOptions(e)){Array.isArray(e.channels)&&(e.channels=e.channels.map(function(e){return e+="_presence"}));var n=new i["default"]({name:l.RocketTypes.subscribe,permission:s["default"].READ,singleTimeout:a.SocketTimeout.commonInfiniteSingle,totalTimeout:a.SocketTimeout.commonInfiniteTotal,params:{channels:e.channels},success:function(){var n=new u["default"]({channels:e.channels,onSuccess:e.onSuccess,onFailed:e.onFailed,onPresence:e.onPresence});t.presenters.push(n),e.onSuccess({code:200,content:"ok"})},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});this.pubSub.goEasySocket.emit(n)}}},{key:"unsubscribePresence",value:function(e){var t=this;if(this.formatCallback(e),r.calibrator.isDef(e.channel))if(e.channel+="_presence",this.findPresenceByChannel(e.channel)){var n=new i["default"]({name:l.RocketTypes.unsubscribe,params:{channel:e.channel},permission:s["default"].READ,singleTimeout:a.SocketTimeout.commonRequestSingle,totalTimeout:a.SocketTimeout.commonRequestTotal,success:function(){e.onSuccess({code:200,content:"ok"}),t.removeChannel(e.channel)},fail:function(t){e.onFailed({code:t.resultCode,content:t.content})}});this.pubSub.goEasySocket.emit(n)}else e.onFailed({code:400,content:"channel["+e.channel+"] is not subscribed"});else e.onFailed({code:400,content:"channel is required"})}},{key:"removeChannel",value:function(e){for(var t=0;t<this.presenters.length;t++)for(var n=this.presenters[t].channels,o=0;o<n.length;o++)if(n[o]==e){this.presenters[t].channels.splice(o,1);break}}},{key:"findPresenceByChannel",value:function(e){for(var t=!1,n=null,o=this.presenters.length-1;o>=0;o--){for(var r=this.presenters[o].channels,i=0;i<r.length;i++)if(r[i]==e){t=!0,n=this.presenters[o];break}if(t)break}return n}}]),e}();t["default"]=h},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.channels=[],this.onSuccess=null,this.onFailed=null,this.onPresence=null,this.channels=t.channels,this.onSuccess=t.onSuccess,this.onFailed=t.onFailed,this.onPresence=t.onPresence}return o(e,[{key:"empty",value:function(){}}]),e}();t["default"]=r},function(e,t,n){"use strict";var o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var o,r,i=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(o=i.next()).done;)s.push(o.value)}catch(a){r={error:a}}finally{try{o&&!o.done&&(n=i["return"])&&n.call(i)}finally{if(r)throw r.error}}return s};t.__esModule=!0,t.GoEasyNotification=void 0;var r=n(27),i=n(0),s=n(10),a=n(65),u=n(18),c=n(23),l=n(6),f=n(2),p=n(57),h=function(){function e(e){this.uniappPlugin=null,this.regIdPromise=null,this.onClickNotificationCallback=null,this.allowNotification=e,this.supportNotification()&&(this.uniappPlugin=uni.requireNativePlugin("GoEasy-Uniapp"),this.uniappPlugin?this.regIdPromise=this.askRegId():console.warn("No GoEasy-Uniapp Native Plugin."))}return e.prototype.listenNewMessage=function(){var e=this;this.supportNotification()&&(s.GoEasyEventCenter.on(p.SocketEvents.IM_MESSAGE_RECEIVED,function(t){return e.onReceivedIMMessage(t)}),s.GoEasyEventCenter.on(a.PUBSUB_INTERNAL_EVENTS.MESSAGE_RECEIVED,function(t){return e.onReceivedPubSubMessage(t)}))},e.prototype.onReceivedIMMessage=function(e){var t=this,n=e.nt;if(i.calibrator.isObject(n)&&r.uniApp.runningBackend()&&e.s!==l.IM.userId){var s=e.i,a=e.ts,u=e.mt,c=e.s,p=e.r,h=e.r,d=e.t,y={id:s,tm:a,t:u,sid:c,rid:p,gid:h,tt:d,nt:n,sd:null,gd:null};d===f.Scene.PRIVATE?l.im._dataCache.loadData(c,d).then(function(e){y.sd=JSON.stringify(e),t.createLocalNotification(y)})["catch"](function(e){t.createLocalNotification(y)}):d===f.Scene.GROUP?Promise.all([l.im._dataCache.loadData(c,f.Scene.PRIVATE),l.im._dataCache.loadData(h,f.Scene.GROUP)]).then(function(e){var n=o(e,2),r=n[0],i=n[1];y.sd=JSON.stringify(r),y.gd=JSON.stringify(i),t.createLocalNotification(y)})["catch"](function(e){t.createLocalNotification(y)}):this.createLocalNotification(y)}},e.prototype.onReceivedPubSubMessage=function(e){if(i.calibrator.isObject(e.nt)&&r.uniApp.runningBackend()){var t={tm:e.t,ch:e.n,ctt:e.c,nt:e.nt};this.createLocalNotification(t)}},e.prototype.createLocalNotification=function(e){JSON.stringify(e);var t=e.nt.t,n=e.nt.c,o=Object.assign({title:t,body:n},e,{g:1});JSON.stringify(o),delete o.nt,i.calibrator.isObject(o)&&o.body&&o.title?"undefined"!=typeof plus&&plus.push.createMessage(o.body,JSON.stringify(o),{title:o.title}):console.warn("The notification message must contain the <title> and <body> fields")},e.prototype.askRegId=function(){var e=this,t=null,n=0,o=function(){return new Promise(function(r,i){e.uniappPlugin.regId(function(e){r(e)},function(r){if(!(1e6===r.data.code&&n<=10))return clearTimeout(t),i(r);t=setTimeout(function(){n++,e.regIdPromise=o()},3500)})})};return o()},e.prototype.getRegIdPromise=function(){return this.regIdPromise},e.prototype.supportNotification=function(){var e=c.PlatformDetector.currentPlatform(),t=u.FrameworkDetector.currentFramework();return this.allowNotification&&t===u.Framework.UNIAPP&&(e===c.Platform.APP_ANDROID||e===c.Platform.APP_IOS)},e.prototype.parseMessage=function(e){return e.ch?{channel:e.ch,content:e.ctt}:{messageId:e.id,timestamp:e.tm,type:e.t,senderId:e.sid,senderData:e.sd?JSON.parse(e.sd):undefined,toType:e.tt,groupId:e.gid,groupData:e.gd?JSON.parse(e.gd):undefined}},e.prototype.listenPlusClickNotification=function(){var e=this;plus.push.addEventListener("click",function(t){if(t&&t.payload)try{var n="string"==typeof t.payload?JSON.parse(t.payload):t.payload,o=e.parseMessage(n);plus.push.clear(),e.onClickNotificationCallback(o)}catch(r){}})},e.prototype.availableIntent=function(e){return e&&Object.keys(e).length&&e.g&&1===parseInt(e.g)},e.prototype.extactIntentIfXiaoMi=function(e){var t=/content=\{(\{.*\})\},/;if(e.key_message&&t.exec(e.key_message)){var n=e.key_message.match(t);e=n.length?JSON.parse(n[1]):null}return e},e.prototype.getIntentData=function(){var e=this;this.uniappPlugin.getIntentData(function(t){if(e.availableIntent(t)){var n=e.parseMessage(t),o=c.PlatformDetector.currentPlatform();plus.push.clear(),o===c.Platform.APP_ANDROID&&e.uniappPlugin.clearAll(),e.onClickNotificationCallback(n)}})},e.prototype.onClickNotification=function(e){if(this.supportNotification()){if(!i.calibrator.isFunction(e))throw new Error("The arguments must be a function.");null===this.onClickNotificationCallback?(this.onClickNotificationCallback=e,this.listenPlusClickNotification(),this.uniappPlugin&&this.getIntentData()):console.warn("The onClickNotification event has been listened on. Please do not listen to it more than once.")}else console.warn("The current environment doesn't support or allowNotification is false.")},e}();t.GoEasyNotification=h}])["default"]});
